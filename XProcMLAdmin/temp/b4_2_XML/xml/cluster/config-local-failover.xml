<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="config-local-failover.css" type="text/css" charset="UTF-8"?>
<XML>
<TITLE> </TITLE><Heading-1>
<A ID="pgfId-1040610"></A>
<A ID="18635"></A>
Configuring Local-Disk Failover for a Forest</Heading-1>
<pagenum>
<A ID="pgfId-1043803"></A>
47</pagenum>
<Body>
<A ID="pgfId-1043807"></A>
This chapter describes the procedure for configuring local-disk failover for a forest. For details about how failover works and the requirements for failover, see <A href="failover.xml#id(82157)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'High Availability of Data Nodes With Failover' on page 26</A>. For details on configuring shared-disk failover, see <A href="config_failover.xml#id(18635)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Configuring Shared-Disk Failover for a Forest' on page 47</A>. This chapter includes the following sections:</Body>
<Body-bullet>
<A ID="pgfId-1047705"></A>
<A href="config-local-failover.xml#id(26556)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Setting Up Local-Disk Failover for a Forest</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1047709"></A>
<A href="config-local-failover.xml#id(13214)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Reverting a Failed Over Forest Back to the Primary Host</Hyperlink>
</A></Body-bullet>
<Body>
<A ID="pgfId-1056711"></A>
For other failover administrative procedures that apply to both local-disk and shared-disk failover, see <A href="config-both-failover.xml#id(18635)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Other Failover Configuration Tasks' on page 51</A>.</Body>
<Heading-2>
<A ID="pgfId-1047710"></A>
<A ID="26556"></A>
Setting Up Local-Disk Failover for a Forest</Heading-2>
<Body>
<A ID="pgfId-1047714"></A>
Setting up failover for a forest is a relatively simple administrative process. This section describes this procedure. There are two basic parts to the procedure:</Body>
<Body-bullet>
<A ID="pgfId-1048577"></A>
<A href="config-local-failover.xml#id(69480)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Enabling Failover in a Group</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1048581"></A>
<A href="config-local-failover.xml#id(33427)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Configuring Local-Disk Failover For a Forest</Hyperlink>
</A></Body-bullet>
<Heading-3>
<A ID="pgfId-1048582"></A>
<A ID="69480"></A>
Enabling Failover in a Group</Heading-3>
<Body>
<A ID="pgfId-1048586"></A>
For each group in which you want to host a failover forest, perform the following steps:</Body>
<Number1>
<A ID="pgfId-1047754"></A>
Before setting up failover, ensure that you have met all the requirements for failover, as described in <A href="failover.xml#id(33472)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Requirements for Local-Disk Failover' on page 34</A>.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1047820"></A>
In the groups configuration page for the group in which the failover host belongs, make sure the <code>
failover enable</code>
 button is set to <code>
true</code>
.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1047821"></A>
<IMAGE xml:link="simple" href="images/fo_group_enable.gif" show="embed" actuate="auto"/>
</Body-indent>
<Body-indent>
<A ID="pgfId-1048628"></A>
This group-level <code>
failover enable</code>
 button provides global control, at the group level, for enabling and disabling failover for all forests in that group.</Body-indent>
<Body>
<A ID="pgfId-1056954"></A>
You can enable or disable failover at the group level at any time. It does not stop you from configuring failover for forests; it only stops failover from actually occurring.</Body>
<Heading-3>
<A ID="pgfId-1048605"></A>
<A ID="33427"></A>
Configuring Local-Disk Failover For a Forest</Heading-3>
<Body>
<A ID="pgfId-1048590"></A>
To set up local-disk failover on a forest and set up one or more replica forests, perform the following steps:</Body>
<Number1>
<A ID="pgfId-1048598"></A>
Before setting up failover, ensure that you have met all the requirements for failover, as described in <A href="failover.xml#id(33472)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Requirements for Local-Disk Failover' on page 34</A> and enable failover for the group, as described in <A href="config-local-failover.xml#id(69480)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Enabling Failover in a Group' on page 43</A>.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1056731"></A>
Create one or more forests on one or more hosts to use as a replica (or use existing forests).</Number>
<Number>
<A ID="pgfId-1056742"></A>
Either create a new forest or use an existing forest on a different host from the replica forest(s). This forest will be the primary forest. If you are modifying an existing forest, skip to step <A href="config-local-failover.xml#id(62236)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
6</Hyperlink>
</A>. To create a new forest, first click the Forests link in the left tree menu, then click the Create tab. The Create Forest page appears. Note the <code>
failover enable</code>
 button and the <code>
failover hosts</code>
 section at the bottom.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1056984"></A>
<IMAGE xml:link="simple" href="images/fo_create_ld_forest.gif" show="embed" actuate="auto"/>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1057033"></A>
Enter a name for the forest.</Number>
<Number>
<A ID="pgfId-1057048"></A>
Specify a data directory.</Number>
<Number>
<A ID="pgfId-1057057"></A>
<A ID="62236"></A>
Select <code>
true</code>
 for <code>
failover enable</code>
. Note that <code>
failover enable</code>
 must be set to <code>
true</code>
 at both the forest and the group level for failover to be active.</Number>
<Number>
<A ID="pgfId-1047859"></A>
Select the replica forest from the drop down menu for <code>
forest replicas</code>
. You can set one or more replica forests.</Number>
<Number>
<A ID="pgfId-1047868"></A>
Click OK to create or modify the forest.</Number>
</NumberList>
<Body>
<A ID="pgfId-1047875"></A>
The forest is now configured with the specified replica forests. You must attach the primary forest to a database before you can use the forest, but it is ready and set up for failover. You cannot attach the replica forests to a database; they will automatically be kept up-to-date as you update content in the primary forest. </Body>
<Heading-2>
<A ID="pgfId-1047715"></A>
<A ID="13214"></A>
Reverting a Failed Over Forest Back to the Primary Host</Heading-2>
<Body>
<A ID="pgfId-1047719"></A>
If a forest fails over to a failover host, causing a replica forest to take the role of the primary forest, the replica forest will remain in the open state until the host unmounts the forest. If you have a failed over forest and want to revert it back to the original primary host (<Emphasis>
unfailover</Emphasis>
 the forest), you must either restart the forest that is open or restart the host in which the forest open. You should only do this if the original primary forest has a state of <Emphasis>
sync replicating</Emphasis>
, which indicates that it is up-to-date and ready to take over. After restarting the forest that is currently <Emphasis>
open</Emphasis>
, the forest will automatically <Emphasis>
open</Emphasis>
 on the primary host (if the original primary forest is in the state <Emphasis>
sync replicating</Emphasis>
). Make sure the primary host is back online and corrected before attempting to unfailover the forest. To check the status of the hosts in the cluster, see the Cluster Status Page in the Admin Interface. To check the status of the forest, see the Forest Status Pages in the Admin Interface.</Body>
<Body>
<A ID="pgfId-1047891"></A>
To restart the forest, perform the following steps:</Body>
<Number1>
<A ID="pgfId-1047892"></A>
Navigate to the Status page for the forest that has failed over. For example, if the forest name is myFailoverForest, click Forests &gt; myFailoverForest in the left tree menu, then click the Status tab.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1047904"></A>
On the Forest Status page, click the restart button.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1047905"></A>
<IMAGE xml:link="simple" href="images/fo_forest_restart.gif" show="embed" actuate="auto"/>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1047912"></A>
Click OK on the Restart Forest confirmation page.</Number>
<Number>
<A ID="pgfId-1047973"></A>
When the Forest Status page returns, if the Mount State is <code>
unmounted</code>
, the forest might not have completed mounting. Refresh the page and the Mount State should indicate that the forest is <code>
open</code>
.</Number>
</NumberList>
<Body>
<A ID="pgfId-1047920"></A>
The forest is restarted, and if the primary host is available, the primary host will mount the forest. If the primary host is not available, the first failover host will try to mount the forest, and so on until there are no more failover hosts to try. If you look in the <code>
ErrorLog.txt</code>
 log file for the primary host, you will see messages similar to the following:</Body>
<Code>
<A ID="pgfId-1047929"></A>
2010-09-13 20:16:47.751 Info: Mounted forest myFailoverForest locally on /space/marklogic/Forests/myFailoverForest</Code>
<Code>
<A ID="pgfId-1056829"></A>
2010-09-13 20:16:47.751 Info: Forest replica accepts forest myFailoverForest as the master with timestamp 2564905551526239330</Code>
<Body>
<A ID="pgfId-1056874"></A>
If you look at the <code>
ErrorLog.txt</code>
 log file for any other host in the cluster, you will see messages similar to the following:</Body>
<Code>
<A ID="pgfId-1047947"></A>
2010-09-13 20:16:47.751 Info: Forest failover1 accepts forest myFailover as the master with timestamp 2564905551526239330</Code>
<Code>
<A ID="pgfId-1056902"></A>
2010-09-14 17:01:29.651 Info: Forest replica1 starting synchronization to forest failover1</Code>
<Code>
<A ID="pgfId-1056903"></A>
2010-09-14 17:01:29.666 Info: Forest replica1 starting bulk replication to forest failover1</Code>
<Code>
<A ID="pgfId-1056904"></A>
2010-09-14 17:01:29.776 Info: Forest replica1 needs to replicate 0 fragments to forest failover1</Code>
<Code>
<A ID="pgfId-1056905"></A>
2010-09-14 17:01:29.776 Info: Forest replica1 finished bulk replicated 0 fragments to forest failover1</Code>
<Code>
<A ID="pgfId-1056906"></A>
2010-09-14 17:01:29.807 Info: Forest replica1 finished bulk replication to forest failover1</Code>
<Code>
<A ID="pgfId-1056894"></A>
2010-09-14 17:01:29.822 Info: Forest replica1 finished synchronizing to replica forest failover1</Code>
<Code>
<A ID="pgfId-1056932"></A>
2010-09-14 17:09:26.638 Info: Forest replica1 accepts forest failover1 as the master with precise time 12845094147890000</Code>
</XML>
