<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="config-both-failover.css" type="text/css" charset="UTF-8"?>
<XML>
<TITLE> </TITLE><Heading-1>
<A ID="pgfId-1040610"></A>
<A ID="18635"></A>
Other Failover Configuration Tasks</Heading-1>
<pagenum>
<A ID="pgfId-1043803"></A>
55</pagenum>
<Body>
<A ID="pgfId-1043807"></A>
This chapter describes the other failover procedures for configuring failover for a forest. The task here apply to both local-disk and shared-disk failover. For details about how failover works and the requirements for failover, see <A href="failover.xml#id(82157)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'High Availability of Data Nodes With Failover' on page 26</A>. For details on configuring local-disk failover, see <A href="config-local-failover.xml#id(18635)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Configuring Local-Disk Failover for a Forest' on page 43</A>. For details on configuring shared-disk failover, see <A href="config_failover.xml#id(18635)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Configuring Shared-Disk Failover for a Forest' on page 47</A>. This chapter includes the following sections:</Body>
<Body-bullet>
<A ID="pgfId-1048029"></A>
<A href="config-both-failover.xml#id(95009)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
XDQP Timeout, Host Timeout, and Host Initial Timeout Parameters</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1048030"></A>
<A href="config-both-failover.xml#id(37811)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Disabling Failover for a Group or a Forest</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1048168"></A>
<A href="config-both-failover.xml#id(74893)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Moving An Existing Private Forest to a Public Directory</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1048334"></A>
<A href="config-both-failover.xml#id(57935)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Migrating the Security Database to Use Failover Forests</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1048557"></A>
<A href="config-both-failover.xml#id(79404)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Migrating Other Auxiliary Databases to Use Failover Forests</Hyperlink>
</A></Body-bullet>
<Heading-2>
<A ID="pgfId-1048001"></A>
<A ID="95009"></A>
XDQP Timeout, Host Timeout, and Host Initial Timeout Parameters</Heading-2>
<Body>
<A ID="pgfId-1048002"></A>
The XDQP port is the port in which each host in the cluster listens for communication with the other hosts in the cluster. This communication happens over the XDQP port, which is set to 7999 by default. The XDQP port must be open on the network so that all other hosts in the cluster can communicate over it. If the XDQP port is not available, then hosts can get <code>
XDMP-FORESTMNT</code>
 and other errors when trying to start up. For more details about communication between nodes in a cluster, see <A href="clustering.xml#id(87995)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Communication Between Nodes' on page 24</A>.</Body>
<Body>
<A ID="pgfId-1056654"></A>
Each group configuration has an <code>
xdqp timeout</code>
, a <code>
host timeout</code>
, and a <code>
host initial timeout</code>
 setting. These settings monitor activity over the XDQP port, and govern the time periods which will induce failover in various scenarios. </Body>
<Body>
<A ID="pgfId-1048677"></A>
The <code>
xdqp timeout</code>
 is the time, in seconds, after which communication between e-node and d-node hosts (which happens over an internal MarkLogic Server protocol named XDQP) will time out if the host is unresponsive. If an <code>
xdqp timeout</code>
 is reached during a request (for example, during a query), a message is logged to the <code>
ErrorLog.txt</code>
 file and the request is retried until the <code>
host timeout</code>
 is reached, after which time, if the d-node host is still unresponsive, the request will fail with an exception. The <code>
host timeout</code>
 is the time, in seconds, after which a host will time out if the host is responsive, and then it will be disconnected from the cluster. The <code>
xdqp timeout</code>
 must be less than the <code>
host timeout</code>
, and should typically be about one-third the value of the <code>
host timeout</code>
. This allows the system to restart the connection with the unresponsive host after the <code>
xdqp timeout</code>
 occurs but before the host is disconnected from the cluster. The <code>
host timeout</code>
 is what can trigger a forest to fail over. For details on when a forest will fail over, see <A href="failover.xml#id(32764)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Scenarios that Cause a Forest to Fail Over' on page 36</A>.</Body>
<Body>
<A ID="pgfId-1048025"></A>
The default settings for <code>
xdqp timeout</code>
 and <code>
host timeout</code>
 should work well for most configurations. If, however, you are seeing hosts disconnect from the cluster because of timeouts, you can raise these limits (keeping the 1 to 3 ratio between <code>
xdqp timeout</code>
 and <code>
host timeout</code>
). Keep in mind, though that if the hosts are timing out, there might be some other issue that is causing the timeouts (such as a network problem, a disconnected cable, and so on).</Body>
<Body>
<A ID="pgfId-1048141"></A>
<IMAGE xml:link="simple" href="images/fo_timeouts.gif" show="embed" actuate="auto"/>
</Body>
<Body>
<A ID="pgfId-1048124"></A>
The <code>
host initial timeout</code>
 is the time, in seconds, that an instance of MarkLogic Server will wait for another node to come online when the cluster first starts up before deciding that the node is down. This setting is designed to allow for 'staggered' cluster startups, where one machine might take a little longer to reboot than another, and avoid unneeded failover of forests during this initial system startup period. The default setting is 4 minutes, and is based on the amount of time it might take for an entire system to reboot (after a power outage, for example). Failover for any forests on a particular host will not be initiated during that cluster startup for this time period. If you know that your machines take more or less time to start up, you can change the <code>
host initial timeout</code>
 accordingly.</Body>
<Heading-2>
<A ID="pgfId-1047913"></A>
<A ID="37811"></A>
Disabling Failover for a Group or a Forest</Heading-2>
<Body>
<A ID="pgfId-1047985"></A>
You can disable failover at two levels of granularity: you disable failover for a group, or you can disable failover for an individual forest. To disable failover, navigate to the group or the forest and set <code>
failover enable</code>
 to <code>
false</code>
. Then, if a primary host fails, it will not fail over.</Body>
<Heading-2>
<A ID="pgfId-1048169"></A>
<A ID="74893"></A>
Moving An Existing Private Forest to a Public Directory</Heading-2>
<Body>
<A ID="pgfId-1048173"></A>
In order to configure failover on a forest, it must be configured to use a supported clustered filesystem (for details, see <A href="failover.xml#id(80780)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Public Forest Required' on page 35</A>). If you have a private forest with which you want to use failover, you must move the contents of that forest into a forest configured to store its data on a supported CFS.</Body>
<Body>
<A ID="pgfId-1048190"></A>
The following procedure assumes there is no activity on the forest(s) being moved. If there are any updates to the forest(s) being moved, they might end up in different states. Note that this should not be done on active systems, as there will be a short outage period between detaching the old forest and attaching the new forest. </Body>
<Body>
<A ID="pgfId-1048712"></A>
To move an existing private forest to a public directory, perform the following steps:</Body>
<Number1>
<A ID="pgfId-1048191"></A>
<A ID="39190"></A>
Use the forest backup/restore page of the Admin Interface to backup the private forest. For example, for a forest named <code>
test</code>
, navigate to the forest <code>
test</code>
 in the Admin Interface, select the Backup/Restore tab, enter a backup directory, select backup, and click OK. For the detailed Backup/Restore procedure, see the <Emphasis>
Administrator's Guide</Emphasis>
.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1048222"></A>
Create a new forest. For the new forest:</Number>
</NumberList>
<Body-bullet-2>
<A ID="pgfId-1048225"></A>
Enter the name of the directory where you want the forest data stored (the directory must be on a supported CFS).</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1048243"></A>
Set the <code>
failover enable</code>
 option to <code>
true</code>
.</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1048250"></A>
Select one or more failover hosts.</Body-bullet-2>
<Body-indent>
<A ID="pgfId-1048255"></A>
<IMAGE xml:link="simple" href="images/fo_create_forest2.gif" show="embed" actuate="auto"/>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1048227"></A>
For the new forest, select the Backup/Restore tab.</Number>
<Number>
<A ID="pgfId-1048269"></A>
Enter the name of the directory in which you backed up your private forest in step <A href="config-both-failover.xml#id(39190)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
1</Hyperlink>
</A>.</Number>
<Number>
<A ID="pgfId-1048274"></A>
Select the Restore button and click OK. Confirm the restore operation to restore the forest.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1048363"></A>
The new forest is now configured for failover and is ready to be attached to a database. Note that if you attach this forest to a database, be sure to first detach the one in which it was restored from (see steps <A href="config-both-failover.xml#id(65072)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
8</Hyperlink>
</A> and <A href="config-both-failover.xml#id(55587)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
9</Hyperlink>
</A>). </Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1048438"></A>
If you are moving the Security database or one of the other auxiliary databases (Schemas, Modules, and Triggers), skip the next steps and continue with the procedure described in <A href="config-both-failover.xml#id(57935)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Migrating the Security Database to Use Failover Forests' on page 54</A>. </Number>
<Number>
<A ID="pgfId-1048450"></A>
To detach the old forest and attach the new one, continue with the remaining steps in this procedure.</Number>
<Number>
<A ID="pgfId-1048407"></A>
<A ID="65072"></A>
Detach your original private forest from the database, if it is attached. For example, for a forest named <code>
test</code>
 in a database named <code>
testDB</code>
, navigate to the database <code>
testDB</code>
 in the Admin Interface, select the Forests link in the tree menu, and click the detach button corresponding to the original private forest named <code>
test</code>
. Then click OK to detach it.</Number>
<Number>
<A ID="pgfId-1048408"></A>
<A ID="55587"></A>
Attach the newly restored public forest to the database. For example, for a new public forest named <code>
test2</code>
 in a database named <code>
testDB</code>
, navigate to the database <code>
testDB</code>
 in the Admin Interface, select the Forests link in the tree menu, and click the Attach tab. Then select the new public forest named <code>
test2</code>
 and click OK.</Number>
<Number>
<A ID="pgfId-1048714"></A>
Optionally, delete the original private forest.</Number>
</NumberList>
<Heading-2>
<A ID="pgfId-1048321"></A>
<A ID="57935"></A>
Migrating the Security Database to Use Failover Forests</Heading-2>
<Body>
<A ID="pgfId-1048327"></A>
The Security database and all of the other auxiliary databases are set up by default to use private forests (forests that store their data in the default data directory). If you want to configure these databases to use shared-disk failover, then you must first move their forests to public forests that store their data on a supported CFS. </Body>
<Body>
<A ID="pgfId-1048351"></A>
The following procedure creates a new database, attaches the failover-enabled forest to the new database, then changes your configuration to use the new database. This procedures uses the Security database, but will work similarly for the other auxiliary database (Schemas, Modules, and Triggers). For information on migrating the other auxiliary databases, see <A href="config-both-failover.xml#id(79404)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Migrating Other Auxiliary Databases to Use Failover Forests' on page 55</A>.</Body>
<Number1>
<A ID="pgfId-1048367"></A>
Create a new database. For example, navigate to the databases page of the Admin Interface, select the Create tab, and create a new database for example, named <code>
SecurityFailover</code>
). For a more detailed procedure, see the <Emphasis>
Administrator's Guide</Emphasis>
. </Number1>
<NumberList>
<Number>
<A ID="pgfId-1048355"></A>
Perform the procedure described in <A href="config-both-failover.xml#id(74893)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Moving An Existing Private Forest to a Public Directory' on page 53</A> to create a failover-enabled public forest.</Number>
<Number>
<A ID="pgfId-1048457"></A>
Attach the newly restored public forest to the database. For example, for a new public forest named <code>
security2</code>
 in a database named <code>
SecurityFailover</code>
, navigate to the database <code>
SecurityFailover</code>
 in the Admin Interface, select the Forests link in the tree menu, and click the Attach tab. Then select the new public forest named <code>
security2</code>
 and click OK.</Number>
<Number>
<A ID="pgfId-1048477"></A>
<A ID="79494"></A>
In the Admin Interface, navigate to the App Server configuration page for the Admin Interface (for example, Groups &gt; Default &gt; App Servers &gt; Admin [HTTP]). </Number>
</NumberList>
<Note>
<A ID="pgfId-1048533"></A>
This step is not needed for the auxiliary (Schemas, Modules, and Triggers) databases.</Note>
<NumberList>
<Number>
<A ID="pgfId-1048482"></A>
<A ID="64985"></A>
On the Database drop-down list, change the setting from <code>
Security</code>
 (or what ever is the name of your security database) to the new database (in this example, <code>
SecurityFailover</code>
).</Number>
<Number>
<A ID="pgfId-1048491"></A>
Click OK to save the changes.</Number>
<Number>
<A ID="pgfId-1048499"></A>
For every database in your cluster, navigate to the Database Configuration page and change the security database to the newly created <code>
SecurityFailover</code>
 database.</Number>
</NumberList>
<Body>
<A ID="pgfId-1048356"></A>
The new security database named <code>
SecurityFailover</code>
 is now configured with a failover-enabled forest. </Body>
<Heading-2>
<A ID="pgfId-1048516"></A>
<A ID="79404"></A>
Migrating Other Auxiliary Databases to Use Failover Forests</Heading-2>
<Body>
<A ID="pgfId-1048520"></A>
The procedure to migrate the other auxiliary databases (Schemas, Modules, and Triggers) to use failover forests is similar to the previous procedure for the Security database with the following differences:</Body>
<Body-bullet>
<A ID="pgfId-1048525"></A>
You do not need to modify the Admin Interface App Server in step <A href="config-both-failover.xml#id(79494)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
4</Hyperlink>
</A> and <A href="config-both-failover.xml#id(64985)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
5</Hyperlink>
</A> above.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1048549"></A>
For the Schemas and Triggers databases, modify the corresponding entry for each database in the cluster.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1048556"></A>
For the Modules database, for each App Server in the cluster that uses a Modules database, select the newly created modules database.</Body-bullet>
</XML>
