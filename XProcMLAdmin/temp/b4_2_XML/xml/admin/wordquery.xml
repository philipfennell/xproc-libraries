<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="wordquery.css" type="text/css" charset="UTF-8"?>
<XML>
<TITLE> </TITLE><Heading-1>
<A ID="pgfId-1048323"></A>
Word Query Database Settings</Heading-1>
<pagenum>
<A ID="pgfId-1040305"></A>
125</pagenum>
<Body>
<A ID="pgfId-1038003"></A>
This chapter describes how to configure a database to include or exclude elements, add index settings, and perform other configuration changes for <code>
cts:word-query</code>
 operations. The following topics are included:</Body>
<Body-bullet>
<A ID="pgfId-1038821"></A>
<A href="wordquery.xml#id(28237)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Understanding the Word Query Configuration</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1038839"></A>
<A href="wordquery.xml#id(61395)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Configuring Customized Word Query Settings</Hyperlink>
</A></Body-bullet>
<Heading-2>
<A ID="pgfId-1038004"></A>
<A ID="28237"></A>
Understanding the Word Query Configuration</Heading-2>
<Body>
<A ID="pgfId-1046818"></A>
Basic search of words and phrases in MarkLogic Server is based on the query constructor <code>
cts:word-query</code>
. You can control the behavior of these basic searches by changing the database configuration for word query. You can exclude and/or include elements from word queries, and you can add extra indexing options compared to the options configured in the database configuration. This section describes the options available in the word query configuration and includes the following parts:</Body>
<Body-bullet>
<A ID="pgfId-1047646"></A>
<A href="wordquery.xml#id(38676)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Overview of Configuration Options</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1047654"></A>
<A href="wordquery.xml#id(77008)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Understanding Which Elements are Included and Excluded</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1047666"></A>
<A href="wordquery.xml#id(29410)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Adding a Weight to Boost or Lower the Relevance of an Included Element</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1047671"></A>
<A href="wordquery.xml#id(13860)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Specifying An Attribute Value for an Included Element</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1047676"></A>
<A href="wordquery.xml#id(22828)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Understanding the Index Option Configuration</Hyperlink>
</A></Body-bullet>
<Heading-3>
<A ID="pgfId-1046972"></A>
<A ID="38676"></A>
Overview of Configuration Options</Heading-3>
<Body>
<A ID="pgfId-1047718"></A>
The following lists the main options you can set in the word query configuration to control how word queries are resolved in a database:</Body>
<Body-bullet>
<A ID="pgfId-1046847"></A>
By default, all elements are included in the word query configuration and the indexing options are the same as the database indexing options.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1047723"></A>
All word query configurations are set on a per-database basis.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1046913"></A>
The word query configuration controls the behavior of the <code>
cts:word-query</code>
, <code>
cts:words</code>
, and <code>
cts:word-match</code>
 APIs. This includes controlling the words that get indexed, as well as controlling the words that are returned from the filter (evaluator) portion of query evaluation.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1046894"></A>
Word query inherits the database index settings as a starting point for its index settings.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1046851"></A>
You can add extra index options for word query. These added index options will not affect other queries (for example, <code>
cts:element-word-query</code>
, <code>
cts:element-attribute-word-query</code>
).</Body-bullet>
<Body-bullet>
<A ID="pgfId-1046874"></A>
You cannot turn off indexing options that are enabled in the database settings.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1046875"></A>
If you check index options in word query that are enabled in the database, it will not change any behavior. However, if you subsequently disable a database index setting that is checked in the word query settings, it will remain for the word query.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1046904"></A>
You can include and/or exclude named elements from word queries.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1046931"></A>
For any element you include, you can optionally constrain it by a value for a specified attribute.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1047748"></A>
For any element you include, you can optionally specify a weight. The weight is used when determining relevance scores, where a weight greater than 1.0 will boost scores and a weight lower than 1.0 will lower scores for matches within the element.</Body-bullet>
<Heading-3>
<A ID="pgfId-1046936"></A>
<A ID="77008"></A>
Understanding Which Elements are Included and Excluded</Heading-3>
<Body>
<A ID="pgfId-1047384"></A>
You can include and/or exclude elements from word queries. This is useful if you know you will never want to search some element content. This section describes how MarkLogic Server determines what content is included in word queries and what is not when you include and/or exclude elements from the word query configuration.</Body>
<Note>
<A ID="pgfId-1047395"></A>
If you want to be able to search on everything in a word query, but also want a special view of the content that includes and/or excludes some elements, consider creating a field instead of modifying the word query configuration. For details on fields, see <A href="fields.xml#id(61682)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Fields Database Settings' on page&#160;126</A>.</Note>
<Body>
<A ID="pgfId-1046967"></A>
By default, all element content (all text node children of elements) is included in word queries. If you decide to include and/or exclude any elements from word queries, there are rules that govern which non-specified elements are indexed and which are not. The rules are based on inheriting the include state from the parent element. For example, if the parent element is marked as an included element (and is therefore indexed and evaluated for word query), then its children, if they do not appear on the exclude list, are also included.</Body>
<Body>
<A ID="pgfId-1046971"></A>
When MarkLogic Server determines which elements to include/exclude, it walks the XML tree using the following rules:</Body>
<Number1>
<A ID="pgfId-1046951"></A>
Start at the root node of the document.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1046956"></A>
If the root node is included (either because it is explicitly included or because <code>
include document root</code>
 is set to true), MarkLogic Server includes the immediate text node children of the document root element and then moves to its element children. If the root node is excluded, the text nodes are not included and MarkLogic Server moves down the XML tree to its element children.</Number>
<Number>
<A ID="pgfId-1046959"></A>
If the parent element (the root element in this case) was included, MarkLogic Server keeps walking down the tree and including the text node children until it encounters an explicitly excluded element.</Number>
<Number>
<A ID="pgfId-1047313"></A>
If the parent element (the root element in this case) was not included, MarkLogic Server keeps walking down the tree, not including the text node children, until it encounters an explicitly included element.</Number>
<Number>
<A ID="pgfId-1047309"></A>
MarkLogic Server keeps walking down the tree, including or not according to the state inherited from the parent element, until it encounters the next included element (if it is in the <Emphasis>
not included</Emphasis>
 state) or excluded element (if it is in the <Emphasis>
included</Emphasis>
 state). </Number>
<Number>
<A ID="pgfId-1047482"></A>
During this process, when an element is encountered that is neither included nor excluded, it inherits the included state (<Emphasis>
not included</Emphasis>
 or <Emphasis>
included</Emphasis>
) from the parent element.</Number>
<Number>
<A ID="pgfId-1047483"></A>
MarkLogic Server keeps walking down the XML tree using this logic to determine its included state, until it reaches the end of the document.</Number>
</NumberList>
<EndList-root>
<A ID="pgfId-1047432"></A>
The only way to guarantee an element's text node children will be included (assuming you have any elements included and/or excluded) is to add it to the included list, and the only way to guarantee an element is not included is to add it to the excluded list.</EndList-root>
<Body>
<A ID="pgfId-1047230"></A>
The following figure shows what is included for two configurations, one with the root node included and one with the root node excluded. Note that the includes and excludes are the same. The lines below the element names represent the text nodes, and the yes/no indicates whether the content in the text nodes is included in word queries. The <code>
root</code>
 represents the rode node of an XML structure, with elements <code>
A</code>
 and <code>
B</code>
 included and elements <code>
C</code>
 and <code>
D</code>
 excluded. Elements that are not explicitly included or excluded (for example, <code>
E</code>
, <code>
F</code>
, and <code>
Z</code>
) inherit from their parents.</Body>
<Body>
<A ID="pgfId-1046995"></A>
<IMAGE xml:link="simple" href="wordquery-1.gif" show="embed" actuate="auto"/>
</Body>
<Body>
<A ID="pgfId-1047380"></A>
Notice that the <code>
Z</code>
 node, which is not explicitly included or excluded, sometimes is included and sometimes is not included, depending on the include state of its parent element.</Body>
<Heading-3>
<A ID="pgfId-1046978"></A>
<A ID="29410"></A>
Adding a Weight to Boost or Lower the Relevance of an Included Element</Heading-3>
<Body>
<A ID="pgfId-1047496"></A>
When you include an element, one of the options is to add a <code>
weight</code>
 to the included element specification. When you add a weight, all text in this element (including any text in all text node descendants of the element) are weighted by the specified value, changing the relevance at query time. Specifying a weight greater than 1.0 will boost scores and a weight lower than 1.0 will lower scores for matches within the element. </Body>
<Body>
<A ID="pgfId-1048290"></A>
When you specify a weight, the term frequency for any tokens in that element (including tokens in descendant text nodes) is multiplied by that number. This happens during document load, update, or reindexing. For example, if you specify a weight of 2.0, each term will have a term frequency of 2.0, making it as if each term appeared twice (for score calculation purposes). Similarly, if you specify a weight of 0.5, each term will have a term frequency of 0.5. </Body>
<Body>
<A ID="pgfId-1047771"></A>
Adding a weight is useful to boost or lower scores on searches where the match occurs in a given element. For example, if you want matches in <code>
TITLE</code>
 elements to contribute more towards the relevancy score than matches in other elements, you can specify a weight of <code>
2.0</code>
 for the <code>
TITLE</code>
 element. Conversely, if you want matches in <code>
TITLE</code>
 elements to contribute less to the relevancy score than matches in other elements, you can specify a weight of <code>
0.5</code>
 for the <code>
TITLE</code>
 element. For details on how relevance is calculated, see the chapter <A href="../search-dev-guide/cts_query.xml#id(51991)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Composing cts:query Expressions</Hyperlink>
</A> in the <Emphasis>
Search Developer's Guide</Emphasis>
.</Body>
<Heading-3>
<A ID="pgfId-1047493"></A>
<A ID="13860"></A>
Specifying An Attribute Value for an Included Element</Heading-3>
<Body>
<A ID="pgfId-1047544"></A>
When you include an element, one of the options is to specify an attribute value. This option allows you to only include elements with a particular attribute/value pair. The attribute/value pair acts as a predicate on which to constrain the content. For example, consider the following XML snippet:</Body>
<Code>
<A ID="pgfId-1047555"></A>
&lt;chapter class=&quot;history&quot;&gt;some text here&lt;/chapter&gt;
&lt;chapter class=&quot;mathematics&quot;&gt;some more text here&lt;/chapter&gt;
&lt;chapter class=&quot;english&quot;&gt;some other text here&lt;/chapter&gt;
&lt;chapter class=&quot;history&quot;&gt;some different text here&lt;/chapter&gt;
&lt;chapter class=&quot;french&quot;&gt;other text here&lt;/chapter&gt;
&lt;chapter class=&quot;linguistics&quot;&gt;still other text here&lt;/chapter&gt;</Code>
<Body>
<A ID="pgfId-1047556"></A>
For the element <code>
chapter</code>
, if you specify the attribute/value pair of <code>
class</code>
 and <code>
history</code>
, then only the following elements will be included:</Body>
<Code>
<A ID="pgfId-1047623"></A>
&lt;chapter class=&quot;history&quot;&gt;some text here&lt;/chapter&gt;
&lt;chapter class=&quot;history&quot;&gt;some different text here&lt;/chapter&gt;</Code>
<Body>
<A ID="pgfId-1047636"></A>
You can only specify an attribute value for an included element; you cannot specify one for an excluded element.</Body>
<Heading-3>
<A ID="pgfId-1047543"></A>
<A ID="22828"></A>
Understanding the Index Option Configuration</Heading-3>
<Body>
<A ID="pgfId-1046982"></A>
The word query configuration allows you to add some extra indexing options from the ones that are currently set in the database configuration. Adding any index options to the word query configuration does not add those options to the element-based index options. </Body>
<Body>
<A ID="pgfId-1046989"></A>
To add a particular index option to word query, you check the box corresponding to the index option. Adding any index options that are not enabled in the database configuration will cause new and updated documents to use the new indexing for word query, and will trigger a reindex operation if <code>
reindex enable</code>
 is set to true in the database configuration.</Body>
<Body>
<A ID="pgfId-1046986"></A>
Options that are enabled in the database configuration appear in bold on the word query configuration. If you check the box next to an option with bold-face type, it does not change your configuration. However, if you subsequently disable that index option in the database configuration, it will remain enabled for word query as long as the box is checked.</Body>
<Heading-2>
<A ID="pgfId-1046835"></A>
<A ID="61395"></A>
Configuring Customized Word Query Settings</Heading-2>
<Body>
<A ID="pgfId-1046840"></A>
This section provides the procedure for customizing the word query settings. For details on what the meaning of the various configuration options in fields, see <A href="wordquery.xml#id(28237)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Understanding the Word Query Configuration' on page&#160;118</A>. The following is the procedure for modifying the word query configuration for your database:</Body>
<Note>
<A ID="pgfId-1047890"></A>
When you modify the word query settings, those modifications apply to all queries that use the <code>
cts:word-query</code>
 constructor, which is the default constructor for <code>
cts:search</code>
. If you want to be able to search on everything in a word query, but also want a special view of the content that includes and/or excludes some elements, consider creating a field instead of modifying the word query configuration. For details on fields, see <A href="fields.xml#id(61682)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Fields Database Settings' on page&#160;126</A>. </Note>
<Body>
<A ID="pgfId-1047898"></A>
Use the Admin Interface to perform the following steps to add a new field configuration to a database.</Body>
<Number1>
<A ID="pgfId-1047899"></A>
Access the Admin Interface in a browser.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1048043"></A>
Navigate to and click the database for which you want to modify the word query configuration, either from one of the summary tables or in the left tree menu.</Number>
<Number>
<A ID="pgfId-1047900"></A>
Under the database in which you want to create the field, click the Word Query link. The Word Query Configuration page appears.</Number>
<Number>
<A ID="pgfId-1047911"></A>
If you want the word queries to include any extra index options from the database, check those index settings. Index settings shown in bold indicate the setting is inherited from the database setting. For details, see <A href="wordquery.xml#id(22828)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Understanding the Index Option Configuration' on page&#160;122</A>.</Number>
<Number>
<A ID="pgfId-1047915"></A>
If you want the word queries to include the root element of the document, even if it is not explicitly included, leave the default of <code>
true</code>
 for include document root button. Note that if you set this to <code>
false</code>
, you will need to include elements in the word query configuration in order to get any results from word queries. Typically, you would leave this set to true and choose some elements to explicitly exclude and some to explicitly include (optionally adding a scoring weight and/or an attribute value constraint).</Number>
<Number>
<A ID="pgfId-1048102"></A>
Click OK to save any changes you made. The configuration page refreshes with after the changes have been made to the MarkLogic Server configuration.</Number>
<Number>
<A ID="pgfId-1047948"></A>
<A ID="16632"></A>
If you want to exclude any elements from word queries, click the Excludes tab.</Number>
<Number>
<A ID="pgfId-1048149"></A>
Enter the namespace URI (if needed) and the localname for the excluded element.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1048150"></A>
<IMAGE xml:link="simple" href="images/wordqueryexclude.gif" show="embed" actuate="auto"/>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1048152"></A>
<A ID="58948"></A>
Click OK.</Number>
<Number>
<A ID="pgfId-1047962"></A>
Repeat steps <A href="wordquery.xml#id(16632)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
7</Hyperlink>
</A> through <A href="wordquery.xml#id(58948)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
9</Hyperlink>
</A> for each element you want to exclude.</Number>
<Number>
<A ID="pgfId-1048119"></A>
<A ID="87940"></A>
Click the Includes tab to specify elements to include in the word query.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1048123"></A>
<IMAGE xml:link="simple" href="images/wordqueryinclude.gif" show="embed" actuate="auto"/>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1048124"></A>
On the Included Element page, specify a localname for the element to include. If the element is in a namespace, specify the namespace URI for the element to include.</Number>
<Number>
<A ID="pgfId-1048125"></A>
[OPTIONAL] If you want to boost or lower the relevance contribution for matches within this element, specify a weight other than the default of 1.0. Weights greater than 1.0 will boost the relevance contribution and weights lower than 1.0 will lower the contribution.</Number>
<Number>
<A ID="pgfId-1048126"></A>
[OPTIONAL] If you want to only include elements that have an attribute with a specified value, enter the attribute namespace URI (if needed), the attribute localname, and a value for the attribute. Then only elements containing attributes with the specified value will be included. You must specify the exact value; no wildcard characters are used.</Number>
<Number>
<A ID="pgfId-1048128"></A>
<A ID="26187"></A>
When you have specified everything for this element, click OK.</Number>
<Number>
<A ID="pgfId-1048135"></A>
Repeat steps <A href="wordquery.xml#id(87940)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
11</Hyperlink>
</A> through <A href="wordquery.xml#id(26187)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
15</Hyperlink>
</A> for each element you want to include.</Number>
<Number>
<A ID="pgfId-1048174"></A>
You can delete any included or excluded fields from the tables at the bottom of the field configuration page.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1048175"></A>
<IMAGE xml:link="simple" href="images/wordquerysumdelete.gif" show="embed" actuate="auto"/>
</Body-indent>
<Body>
<A ID="pgfId-1038118"></A>
</Body>
</XML>
