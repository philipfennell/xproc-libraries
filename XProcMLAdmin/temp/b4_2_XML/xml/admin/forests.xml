<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="forests.css" type="text/css" charset="UTF-8"?>
<XML>
<TITLE> </TITLE><Heading-1>
<A ID="pgfId-1038002"></A>
<A ID="80927"></A>
Forests</Heading-1>
<pagenum>
<A ID="pgfId-1050466"></A>
186</pagenum>
<Body>
<A ID="pgfId-1049490"></A>
This section describes forests in the MarkLogic Server, and includes the following sections:</Body>
<Body-bullet>
<A ID="pgfId-1038011"></A>
<A href="forests.xml#id(43487)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Understanding Forests</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1049550"></A>
<A href="forests.xml#id(45952)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Creating a Forest</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1046616"></A>
<A href="forests.xml#id(85362)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Making a Forest Delete-Only</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1049878"></A>
<A href="forests.xml#id(72520)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Making a Forest Read-Only</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1046812"></A>
<A href="forests.xml#id(93728)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Attaching and Detaching Forests Using the Forest Summary Page</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1038015"></A>
<A href="forests.xml#id(76303)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Making Backups of a Forest</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1038019"></A>
<A href="forests.xml#id(13805)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Restoring a Forest</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1054011"></A>
<A href="forests.xml#id(25187)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Rolling Back a Forest to a Point In Time</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1038023"></A>
<A href="forests.xml#id(35475)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Merging a Forest</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1049393"></A>
<A href="forests.xml#id(97024)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Clearing a Forest</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1049143"></A>
<A href="forests.xml#id(18663)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Disabling a Forest</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1053851"></A>
<A href="forests.xml#id(78933)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Deleting a Forest from a Host</Hyperlink>
</A></Body-bullet>
<Body>
<A ID="pgfId-1053921"></A>
This chapter describes how to use the Admin Interface to manage forests. For details on how to manage forests programmatically, see <A href="../AdminAPI/configure.xml#id(26239)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Creating and Configuring Forests and Databases</Hyperlink>
</A> and <A href="../AdminAPI/maintenance.xml#id(23137)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Database Maintenance Operations</Hyperlink>
</A> in the <Emphasis>
Scripting Administrative Tasks Guide</Emphasis>
.</Body>
<Heading-2>
<A ID="pgfId-1053857"></A>
<A ID="43487"></A>
Understanding Forests</Heading-2>
<Body>
<A ID="pgfId-1049537"></A>
A forest is a collection of XML, text, or binary documents. Forests are created on hosts and attached to databases to appear as a contiguous set of content for query purposes. A forest can only be attached to one database at a time. You cannot load data into a forest that is not attached to a database. </Body>
<Body>
<A ID="pgfId-1049596"></A>
A forest is made up of in-memory and on-disk structures called <Emphasis>
stands</Emphasis>
. Each stand is comprised of self-consistent XML, binary, and/or text fragments, stored in document order. When fragmentation rules are in place, XML documents may span multiple stands. MarkLogic Server periodically merges multiple stands into a single stand to optimize performance. See <A href="merges.xml#id(83498)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Understanding and Controlling Database Merges' on page&#160;138</A> for details on merges.</Body>
<Body>
<A ID="pgfId-1049780"></A>
By default, the operations allowed on a forest are: read, insert, update, and delete. You can control which operations are allowed on a forest by setting the following update types:</Body>
<TableAnchor>
<A ID="pgfId-1049840"></A>
</TableAnchor>
<TABLE>
<ROW>
<TH ROWSPAN="1" COLSPAN="1">
<CellHeading>
<A ID="pgfId-1049806"></A>
Update Type</CellHeading>
</TH>
<TH ROWSPAN="1" COLSPAN="1">
<CellHeading>
<A ID="pgfId-1049808"></A>
Description</CellHeading>
</TH>
</ROW>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1049810"></A>
<code>
All</code>
</CellBody>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1049812"></A>
Read, insert, update, and delete operations are allowed on the forest.</CellBody>
</CELL>
</ROW>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1049814"></A>
<code>
delete-only</code>
</CellBody>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1049816"></A>
Read and delete operations are allowed on the forest, but insert and update operations are not allowed. This update type is useful when you want to eliminate the overhead imposed by the merge operation, but still allow transactions to delete data from the forest. See <A href="forests.xml#id(20932)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Making a Forest Delete-Only' on page&#160;176</A> for details.</CellBody>
</CELL>
</ROW>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1049818"></A>
<code>
read-only</code>
</CellBody>
<CellBody>
<A ID="pgfId-1050197"></A>
</CellBody>
<CellBody>
<A ID="pgfId-1050208"></A>
(Can only be set in Configure)</CellBody>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1049820"></A>
Read operations are allowed on the forest, but insert, update, and delete operations are not allowed. A transaction attempting to make changes to fragments in the forest will throw an exception. This update type is useful when you want to put your forests on read-only media and allow them to be queried. See <A href="forests.xml#id(72520)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Making a Forest Read-Only' on page&#160;177</A> for details.</CellBody>
</CELL>
</ROW>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1050228"></A>
<code>
flash-backup</code>
</CellBody>
<CellBody>
<A ID="pgfId-1050240"></A>
</CellBody>
<CellBody>
<A ID="pgfId-1050229"></A>
(Can only be set in Configure)</CellBody>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1049824"></A>
This type puts the forest in read-only mode without throwing exceptions on insert, update, or delete transactions, allowing the transactions to retry. This update type is useful when you want to temporarily quiesce a forest or to disable changes to the forest data when doing a flash backup of the forest. See <A href="forests.xml#id(72520)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Making a Forest Read-Only' on page&#160;177</A> for details.</CellBody>
</CELL>
</ROW>
</TABLE>
<Note>
<A ID="pgfId-1049794"></A>
To make the entire database read-only, set all of the forests in the database to <code>
read-only</code>
.</Note>
<Body>
<A ID="pgfId-1049650"></A>
</Body>
<Heading-2>
<A ID="pgfId-1042189"></A>
<A ID="45952"></A>
Creating a Forest</Heading-2>
<Body>
<A ID="pgfId-1042190"></A>
To create a new forest, complete the following procedure:</Body>
<Number1>
<A ID="pgfId-1038035"></A>
Click the Forests icon in the left frame.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1048528"></A>
Click the Create tab at the top right. The Create Forest page displays:</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1048533"></A>
<IMAGE xml:link="simple" href="images/forest_create_new.gif" show="embed" actuate="auto"/>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1038041"></A>
Enter the name of your forest in the Forest Name textbox. Each forest name must be unique.</Number>
<Number>
<A ID="pgfId-1042311"></A>
Select the host on which you want the forest to be created.</Number>
<Number>
<A ID="pgfId-1042305"></A>
Enter the path to the Data Directory, which specifies where the forest data is stored. This directory should specify a location on the host's file system with sufficient capacity to store your data.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1042280"></A>
The name of the forest is used by the system as a directory name. Therefore, the forest name must be a legal directory name and cannot contain any of the following 9 characters: <code>
\ * ? / : &lt; &gt; | &quot;</code>
 . Additionally, the name cannot begin or end with a space or a dot (<code>
.</code>
). MarkLogic recommends that you use an absolute path if you specify a data directory. If you do not specify an absolute path for the data directory, your forest will be created in the default data directory. </Body-indent>
<Body-indent>
<A ID="pgfId-1042281"></A>
The Forests directory is either a fully-qualified pathname or is relative to the Forests directory, set at installation time based on the directory in which MarkLogic Server is installed. The following table shows the default location Forest directory for each platform:</Body-indent>
<TableAnchor>
<A ID="pgfId-1042302"></A>
</TableAnchor>
<TABLE>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellHeading>
<A ID="pgfId-1042287"></A>
Platform</CellHeading>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CellHeading>
<A ID="pgfId-1042289"></A>
Program Directory</CellHeading>
</CELL>
</ROW>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1042291"></A>
Microsoft Windows</CellBody>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CodeLeft>
<A ID="pgfId-1042293"></A>
C:\Program Files\MarkLogic\Data\Forests</CodeLeft>
</CELL>
</ROW>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1042295"></A>
Red Hat Linux</CellBody>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CodeLeft>
<A ID="pgfId-1042297"></A>
/var/opt/MarkLogic/Forests</CodeLeft>
</CELL>
</ROW>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1042299"></A>
Sun Solaris</CellBody>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CodeLeft>
<A ID="pgfId-1042301"></A>
/var/opt/MARKlogic/Forests</CodeLeft>
</CELL>
</ROW>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1059209"></A>
Mac OS X</CellBody>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1059211"></A>
<code>
~/MarkLogic/Forests</code>
</CellBody>
</CELL>
</ROW>
</TABLE>
<NumberList>
<Number>
<A ID="pgfId-1038064"></A>
If you want to restrict the types of updates allowed on the field, select the types of updates you want to allow for this forest in the Updates Allowed field. See <A href="forests.xml#id(85362)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Making a Forest Delete-Only' on page&#160;176</A> for details. </Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1047050"></A>
<IMAGE xml:link="simple" href="images/updates_allowed_create.gif" show="embed" actuate="auto"/>
</Body-indent>
<Note>
<A ID="pgfId-1050296"></A>
The Read-Only update types described in <A href="forests.xml#id(72520)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Making a Forest Read-Only' on page&#160;177</A> can be set in the Configure page of an existing forest.</Note>
<NumberList>
<Number>
<A ID="pgfId-1047043"></A>
In the Failover Enable field, specify whether or not to failover this forest to another host if the primary host goes down. For details on configuring failover on a forest, see <A href="../cluster/config_failover.xml#id(18635)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Configuring Shared-Disk Failover for a Forest</Hyperlink>
</A> in the <Emphasis>
Scalability, Availability, and Failover Guide</Emphasis>
.</Number>
<Number>
<A ID="pgfId-1047090"></A>
Select the Failover Host from the Failover Host Name drop down menu:</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1047097"></A>
<IMAGE xml:link="simple" href="images/forest_failover.gif" show="embed" actuate="auto"/>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1047036"></A>
Click OK.</Number>
</NumberList>
<EndList-root>
<A ID="pgfId-1048071"></A>
Creating a forest is a 'hot' admin task; the changes take effect immediately. However, toggling between update types restarts the forest.</EndList-root>
<Heading-2>
<A ID="pgfId-1047270"></A>
<A ID="85362"></A>
<A ID="20932"></A>
Making a Forest Delete-Only</Heading-2>
<Body>
<A ID="pgfId-1047696"></A>
You can configure a forest to only allow read and delete operations, disallowing inserts and updates to any documents stored in the forest. A delete-only forest is useful in cases where you have multiple forests in a database and you want to manage which forests change. To set a forest to only allow delete operations (and disallow inserts and updates), navigate to the configuration page for the forest you want specify as delete-only and set the <code>
updates allowed</code>
 field to <code>
delete-only</code>
.</Body>
<Body>
<A ID="pgfId-1046651"></A>
When a forest is set to delete-only, updates to documents in a delete-only forest that do not specify a forest ID will throw an exception. Updates to documents in a delete-only forest that specify one or more forest IDs of other forests in the database will result in the documents moving to one of those other forests. When a document moves forests, the old version of the document will be marked as deleted, and will be removed from the forest during the next merge. </Body>
<Body>
<A ID="pgfId-1050398"></A>
To specify an update that will move a document in a delete-only forest to an updateable forest, you must specify the forest ID of at least one forest in which updates are allowed. On technique to accomplish this is to always specify all of the forest IDs, as in the following <code>
xdmp:document-insert</code>
 example which lists all of the forests in the database for the <code>
$forest-ids</code>
 parameter:</Body>
<Code>
<A ID="pgfId-1050399"></A>
xdmp:document-insert($uri, $node, (), (), 0, 
&#160;&#160;&#160;xdmp:database-forests(xdmp:database()) ) </Code>
<Note>
<A ID="pgfId-1050400"></A>
You can only move a document from a delete-only forest to a forest that allows updates using an API that takes forest IDs, and then by explicitly setting the forest IDs to include one or more forests that allow updates. The node-level update built-in functions (<code>
xdmp:node-replace</code>
, <code>
xdmp:node-insert-child</code>
, and so on) do not have a forest IDs parameter and therefore do not support moving documents.</Note>
<Body>
<A ID="pgfId-1050401"></A>
Under normal operating circumstances, you likely will not need to set a forest to be delete-only. Additionally, even if the reindexer is enabled at the database level, documents in a forest that is set to delete-only will not be reindexed.</Body>
<Body>
<A ID="pgfId-1050420"></A>
There are cases where delete-only forests are useful, however. One of the use cases for delete-only forests is if you have multiple forests and you want to control when some forests are merging. The best way to control merges in a forest is to not insert any new content in the forest. In this scenario, you can set some of the forests to be delete-only, and then those forests will not merge during that time (unless you manually specify a merge, either with the <code>
xdmp:merge</code>
 API or by clicking the Merge button in the Admin Interface). After a while, you can rotate which forests are delete-only. For example, if you have four forests, you can make two of them delete-only for one day, and then make the other two delete-only the next day, switching the first two forest back to allowing updates. This approach will only have two forests being updated (and periodically merging) at a time, thus needing less disk space for merging. For more details about merges, see <A href="merges.xml#id(83498)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Understanding and Controlling Database Merges' on page&#160;138</A>.</Body>
<Heading-2>
<A ID="pgfId-1047415"></A>
<A ID="72520"></A>
Making a Forest Read-Only</Heading-2>
<Body>
<A ID="pgfId-1048576"></A>
You can configure an existing forest to only allow reads and to disallow inserts, updates and deletes to any documents stored in the forest. </Body>
<Body-indent>
<A ID="pgfId-1050252"></A>
<IMAGE xml:link="simple" href="images/updates_allowed.gif" show="embed" actuate="auto"/>
</Body-indent>
<Body>
<A ID="pgfId-1048780"></A>
MarkLogic Server supports two read-only forest settings:</Body>
<Body-bullet>
<A ID="pgfId-1048650"></A>
<code>
read-only</code>
 -- When this update type is set, update transactions on the forest are immediately aborted. </Body-bullet>
<Body-bullet>
<A ID="pgfId-1048681"></A>
<code>
flash-backup</code>
 -- When this update type is set, update transactions on the forest are retried until either the update type is reset or the Default Time Limit set for the App Server is reached.</Body-bullet>
<Note>
<A ID="pgfId-1048886"></A>
Only existing forests can be set to <code>
read-only</code>
 or <code>
flash-backup</code>
. You cannot create a new forest with these settings.</Note>
<Body>
<A ID="pgfId-1050144"></A>
A read-only forest is useful if you want to put your forests on read-only media and allow them to be queried. Another use of <code>
read-only</code>
 is to control disk space. For example, in a multi-forest database, it might be useful to be able to mark one or more forests as <code>
read-only</code>
 as they reach disk space limits.</Body>
<Body>
<A ID="pgfId-1048887"></A>
One use for <code>
flash-backup</code>
 is to prevent updates to the forest during a flash backup operation, which is a very fast backup that can be done on some file systems. You can set the <code>
flash-backup</code>
 update type to temporarily put the forest in read-only mode for the duration of a flash backup and then reset the update type when the backup has completed. Transactions attempting to make changes to the forest during the backup period are retried. </Body>
<Note>
<A ID="pgfId-1048447"></A>
Toggling between <code>
read-only</code>
 or <code>
flash-backup</code>
 and other forest update types triggers a forest restart. This activity is visible in the log file.</Note>
<Body>
<A ID="pgfId-1048222"></A>
When the <code>
read-only</code>
 or <code>
flash-backup</code>
 update type is set, the forest will have the following characteristics:</Body>
<Body-bullet>
<A ID="pgfId-1048491"></A>
If a database has at least one updateable forest, and an insert, update or delete without a place key is requested, it will choose one of the updateable forests to perform the operation. </Body-bullet>
<Body-bullet>
<A ID="pgfId-1047446"></A>
No merges are allowed on the forest. Attempts to explicitly merge such forests do nothing.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1047447"></A>
No re-indexing/re-fragmenting is allowed on the forest.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1048125"></A>
You cannot upgrade from the forest. An attempt to upgrade will return an error.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1048098"></A>
If a forest is set to read-only or flash-backup, an insert, update, or delete transaction will either generate an exception (in the case of <code>
read-only</code>
) or retried later (in the case of <code>
flash-backup</code>
).</Body-bullet>
<Body-bullet>
<A ID="pgfId-1047448"></A>
You cannot clear, restore, or fully delete the forest. However, you can delete the forest configuration, as described in <A href="forests.xml#id(78933)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Deleting a Forest from a Host' on page&#160;186</A>.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1047449"></A>
Backups are permitted on the forests. However, they will not modify the last backup time in the forest label. Consequently, the last backup time in the forest will denote the last time the forest was backed up when it wasn't read-only or flash-backup. </Body-bullet>
<Body-bullet>
<A ID="pgfId-1048138"></A>
If the database index settings are changed and index detection is set to ‘automatic', then the forests will work, but the indexes won't be picked up. If index detection is set to ‘none', you will get wrong results. </Body-bullet>
<Body-bullet>
<A ID="pgfId-1047708"></A>
You can enable failover on a read-only and flash-backup forest.</Body-bullet>
<Heading-2>
<A ID="pgfId-1046645"></A>
<A ID="93728"></A>
Attaching and Detaching Forests Using the Forest Summary Page</Heading-2>
<Body>
<A ID="pgfId-1046814"></A>
The Forest Summary page lists all of the forests in the cluster, along with various information about each forest such as its status, which host is the primary host, and amount of free space for each forest. It also lists which database each forest is attached to, and allows you to attach and/or detach forests from databases. Alternately, you can use the Database Forest Configuration page to attach and detach a forest, as described in <A href="databases.xml#id(48000)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Attaching and/or Detaching Forests to/from a Database' on page&#160;110</A>.</Body>
<Body>
<A ID="pgfId-1046825"></A>
Perform the following steps using the Admin Interface to attach or detach one or more forests to or from a database:</Body>
<Number1>
<A ID="pgfId-1046827"></A>
Click the Forests icon on the left tree menu. The Forest Summary page appears.</Number1>
<Body-indent>
<A ID="pgfId-1046834"></A>
<IMAGE xml:link="simple" href="images/forest-summary.gif" show="embed" actuate="auto"/>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1046833"></A>
For each forest whose database assignment you want to change, select the name of the new database assignment.</Number>
</NumberList>
<Note>
<A ID="pgfId-1046869"></A>
If you change a database assignment from one database to another, it will detach the forest from the previous setting and attach it to the new setting. Be sure that is what you intend to do. Also, if you detach from one database and attach to another database with different index settings, the forest will begin reindexing if <code>
reindexer&#160;enable</code>
 is set to <code>
true</code>
.</Note>
<NumberList>
<Number>
<A ID="pgfId-1046870"></A>
After you have made your selections, click OK to save the forest assignment changes.</Number>
</NumberList>
<EndList-root>
<A ID="pgfId-1046892"></A>
The forests you attached or detached are now reflected in the database configuration. Attaching and detaching a forest to a database are 'hot' admin tasks.</EndList-root>
<Heading-2>
<A ID="pgfId-1046813"></A>
<A ID="76303"></A>
Making Backups of a Forest</Heading-2>
<Body>
<A ID="pgfId-1038531"></A>
MarkLogic Server backs up forest data by transactionally creating an image copy of a specified forest. You can back up data at the granularity of a forest or of a database. Use the Admin Interface to back up a forest. </Body>
<Body>
<A ID="pgfId-1038544"></A>
Forest-level backups only back up the data in a forest, and are not guaranteed to have a consistent database state to restore. The data in the forest is consistent, but other parts of the database (other forests, the schema database, and so on) might be different when you restore the data. For a guaranteed consistent backup, perform a complete database backup For information on backing up a database, see <A href="backup_restore.xml#id(93243)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Backing Up and Restoring a Database' on page&#160;152</A>.</Body>
<Body>
<A ID="pgfId-1046693"></A>
This section describes the forest backup procedures, and includes the following parts:</Body>
<Body-bullet>
<A ID="pgfId-1046694"></A>
<A href="forests.xml#id(10091)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Backing Up a Forest</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1046701"></A>
<A href="forests.xml#id(59812)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Scheduling a Forest Backup</Hyperlink>
</A></Body-bullet>
<Heading-3>
<A ID="pgfId-1046702"></A>
<A ID="10091"></A>
Backing Up a Forest </Heading-3>
<Body>
<A ID="pgfId-1038068"></A>
To initiate a forest backup using the Admin Interface, complete the following procedure:</Body>
<Number1>
<A ID="pgfId-1038069"></A>
Click the Forests icon on the left tree menu.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1038070"></A>
Decide which forest to back up.</Number>
<Number>
<A ID="pgfId-1038071"></A>
Click the icon for this forest name.</Number>
<Number>
<A ID="pgfId-1038072"></A>
Click the Backup/Restore tab at the top right. The Forest Backup screen appears.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1038076"></A>
<IMAGE xml:link="simple" href="images/forest_backup.gif" show="embed" actuate="auto"/>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1038077"></A>
Enter the name of the directory in which you want the backup copy of the forest. You must provide an absolute path.  Each directory must be unique for each forest.</Number>
<Warning>
<A ID="pgfId-1038078"></A>
The software deletes <Emphasis>
all</Emphasis>
 the files in this directory before writing the new backup. To retain multiple generations of backup, specify a different backup directory for each backup.</Warning>
<Number>
<A ID="pgfId-1038079"></A>
Select Backup.</Number>
<Number>
<A ID="pgfId-1038080"></A>
Click OK.</Number>
<Number>
<A ID="pgfId-1038081"></A>
A confirmation message appears. Click OK again to confirm the backup.</Number>
</NumberList>
<EndList-root>
<A ID="pgfId-1038082"></A>
Your data in the selected forest is now backed up to the specified directory. Backing up your data is a 'hot' admin task; the changes take effect immediately. </EndList-root>
<WarningList>
<Warning>
<A ID="pgfId-1038083"></A>
When performing backups on the Windows platform, ensure that no users have the Forests or Data directories (or any subdirectories within them) open while the backup is being made.</Warning>
</WarningList>
<Heading-3>
<A ID="pgfId-1046710"></A>
<A ID="59812"></A>
Scheduling a Forest Backup</Heading-3>
<Body>
<A ID="pgfId-1046721"></A>
You can schedule forest backups to periodically back up a forest. You can schedule backups to occur daily, weekly, monthly, or you can schedule a one-time backup. You can create as many scheduled backups as you want. To create a scheduled backup, perform the following steps using the Admin Interface:</Body>
<Number1>
<A ID="pgfId-1046737"></A>
Click the Forests icon on the left tree menu.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1046745"></A>
Select the forest for which you want to schedule a backup, either from the tree menu or from the Forest Summary page. The Forest Configuration page appears.</Number>
<Number>
<A ID="pgfId-1046748"></A>
Click the Scheduled Backup link in the tree menu for the forest. The Scheduled Backup Configuration page appears. </Number>
<Number>
<A ID="pgfId-1046757"></A>
On the Scheduled Backup Configuration page, you can delete any existing scheduled backups if you no longer need them.</Number>
<Number>
<A ID="pgfId-1046770"></A>
Click the Create tab. The Create Scheduled Backups page appears</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1046776"></A>
<IMAGE xml:link="simple" href="images/forest-sched-backup.gif" show="embed" actuate="auto"/>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1046771"></A>
Enter the absolute path to the backup directory. The backup directory must have permissions such that the MarkLogic Server process can read and write to it.</Number>
<Number>
<A ID="pgfId-1050506"></A>
Choose a scheduled or one-time for the backup type:</Number>
</NumberList>
<Body-bullet-2>
<A ID="pgfId-1050507"></A>
For minutely, enter how many minutes between each backup. </Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1050508"></A>
For hourly, enter how many hours between each backup. The Backup Minute setting specifies how many minutes after the hour the backup is to start. Note that the Backup Minute setting does not add to the interval.</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1050509"></A>
For daily, enter how many days between each backup and the time of day. </Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1050510"></A>
For weekly, enter how many weeks between each backup, check one or more days of the week, and the time of day for the backup to start. </Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1050511"></A>
For monthly, enter how many months between each backup, select one day of the month (1-31), and the time of day for the backup to start. </Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1050512"></A>
For one-time, enter the backup start date in MM/DD/YYYY notation (for example, 07/29/2009 for July 29, 2009) and time in 24:00 notation.</Body-bullet-2>
<NumberList>
<Number>
<A ID="pgfId-1046792"></A>
Enter the time of day to start the backup.</Number>
<Number>
<A ID="pgfId-1046793"></A>
Click OK to create the scheduled backup.</Number>
</NumberList>
<EndList-root>
<A ID="pgfId-1046794"></A>
The backups will automatically start according to the specified schedule.</EndList-root>
<Heading-2>
<A ID="pgfId-1038084"></A>
<A ID="13805"></A>
Restoring a Forest</Heading-2>
<Body>
<A ID="pgfId-1038085"></A>
You can restore a forest from a backup made earlier either using the Admin Interface. Backups are restored at the forest granularity only.</Body>
<Note>
<A ID="pgfId-1038505"></A>
You can restore a forest in Version 4.1 from a backup made of a pervious version, as long as the previous backup completed cleanly. If the backup did not complete cleanly (journal files are present), then you must restore the forest in the previous version and then upgrade to Version 4.1.</Note>
<Body>
<A ID="pgfId-1038086"></A>
To restore a forest from a backup made previously, complete the following procedure:</Body>
<Number1>
<A ID="pgfId-1038087"></A>
Click the Forests icon on the left tree menu.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1038088"></A>
Decide which forest to restore.</Number>
<Number>
<A ID="pgfId-1038089"></A>
Click the icon for this forest name.</Number>
<Number>
<A ID="pgfId-1038090"></A>
Click the Backup/Restore tab on the top right.</Number>
<Number>
<A ID="pgfId-1038091"></A>
Enter the name of the directory that contains the backup copy of the forest.</Number>
<Number>
<A ID="pgfId-1038092"></A>
Select Restore.</Number>
<Number>
<A ID="pgfId-1038093"></A>
Click OK.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1038094"></A>
A confirmation message displays.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1038095"></A>
Confirm that you want to restore data from this backup directory and click OK.</Number>
</NumberList>
<EndList-root>
<A ID="pgfId-1038096"></A>
Restoring data from your backup is a 'hot' admin task; the changes take effect immediately.</EndList-root>
<WarningList>
<Warning>
<A ID="pgfId-1053965"></A>
When performing restores on the Windows platform, ensure that no users have the Forests or Data directories (or any subdirectories within them) open while the restore process is executing.</Warning>
</WarningList>
<Heading-2>
<A ID="pgfId-1053967"></A>
<A ID="25187"></A>
Rolling Back a Forest to a Point In Time</Heading-2>
<Body>
<A ID="pgfId-1053989"></A>
You can use the <code>
xdmp:forest-rollback</code>
 function to roll the state of one or more forests back to a specified system timestamp. To roll forest(s) back to an earlier timestamp, you must first set the merge timestamp to keep deleted fragments from that specified timestamp. For details on rolling back a forest, including the procedure to perform a rollback, see <A href="../dev_guide/point_in_time.xml#id(84726)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Rolling Back a Forest to a Particular Timestamp</Hyperlink>
</A> in the <Emphasis>
Application Developer's Guide</Emphasis>
 and the <code>
xdmp:forest-rollback</code>
 API documentation in the <Emphasis>
MarkLogic XQuery and XSLT Function Reference</Emphasis>
.</Body>
<Heading-2>
<A ID="pgfId-1053979"></A>
<A ID="35475"></A>
Merging a Forest</Heading-2>
<Body>
<A ID="pgfId-1053970"></A>
You can merge the forest data using the Admin Interface. As described in <A href="merges.xml#id(83498)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Understanding and Controlling Database Merges' on page&#160;138</A>, merging a forest improves performance and is periodically done automatically in the background by MarkLogic Server. The Merge button allows you to explicitly merge the data for this forest.</Body>
<Body>
<A ID="pgfId-1049309"></A>
To explicitly merge the forest, complete the following procedure:</Body>
<Number1>
<A ID="pgfId-1049310"></A>
Click the Forests icon on the left tree menu.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1049311"></A>
Decide which forest you want to merge.</Number>
<Number>
<A ID="pgfId-1049312"></A>
Click the forest name, either on the tree menu or the summary page.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1049313"></A>
The Forest Configuration page displays.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1049314"></A>
Click the Merge button on the Forest Configuration page.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1049315"></A>
A confirmation message displays.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1049316"></A>
Confirm that you want to merge the forest data and click OK.</Number>
</NumberList>
<EndList-root>
<A ID="pgfId-1049317"></A>
Merging data in a forest is a 'hot' admin task; the changes take effect immediately.</EndList-root>
<Heading-2>
<A ID="pgfId-1049275"></A>
<A ID="97024"></A>
Clearing a Forest</Heading-2>
<Body>
<A ID="pgfId-1042409"></A>
You can clear the document data from a forest using the Admin Interface. Clearing a forest removes all fragments from the forest, but does not remove its configuration information.</Body>
<Body>
<A ID="pgfId-1042410"></A>
To clear all data from a forest, complete the following procedure:</Body>
<Number1>
<A ID="pgfId-1042411"></A>
Click the Forests icon on the left tree menu.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1038102"></A>
Decide which forest you want to clear.</Number>
<Number>
<A ID="pgfId-1038103"></A>
Click the forest name, either on the tree menu or the summary page.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1038105"></A>
The Forest Configuration page displays.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1038110"></A>
Click the Clear button on the Forest Configuration page.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1038111"></A>
A confirmation message displays.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1038112"></A>
Confirm that you want to clear the document data from this forest and click OK.</Number>
</NumberList>
<EndList-root>
<A ID="pgfId-1038113"></A>
Clearing data in a forest is a 'hot' admin task; the changes take effect immediately.</EndList-root>
<Heading-2>
<A ID="pgfId-1048979"></A>
<A ID="18663"></A>
Disabling a Forest</Heading-2>
<Body>
<A ID="pgfId-1049034"></A>
You can disable a forest using the Admin Interface. Disabling a forest unmounts the forest from the database and clears all memory caches for all the forests in the database. The database remains unavailable for any query operations while any of its forests are disabled. </Body>
<Body>
<A ID="pgfId-1049189"></A>
Disabling a forest does not delete the configuration or document data. The forest can later be re-enabled by clicking Enable.</Body>
<Body>
<A ID="pgfId-1049105"></A>
To disable a forest, complete the following procedure:</Body>
<Number1>
<A ID="pgfId-1049106"></A>
Click the Forests icon on the left tree menu.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1049107"></A>
Decide which forest you want to disable.</Number>
<Number>
<A ID="pgfId-1049108"></A>
Click the forest name, either on the tree menu or the summary page.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1049109"></A>
The Forest Configuration page displays.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1049110"></A>
Click the Disable button on the Forest Configuration page.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1049111"></A>
A confirmation message displays.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1049112"></A>
Confirm that you want to disable the forest by clicking Disable.</Number>
</NumberList>
<Heading-2>
<A ID="pgfId-1049069"></A>
<A ID="78933"></A>
Deleting a Forest from a Host</Heading-2>
<Body>
<A ID="pgfId-1038132"></A>
You can use the Admin Interface to delete a forest. The are two levels of forest deletion:</Body>
<Body-bullet>
<A ID="pgfId-1048912"></A>
Delete configuration only, which removes the forest configuration information, but preserves the document data.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1048894"></A>
Full Delete, which completely removes the document data and the configuration information for the forest. </Body-bullet>
<Note>
<A ID="pgfId-1048929"></A>
The forest cannot be deleted if it is still attached to a database. Also, you can delete the configuration information on a Read-Only or Flash-Backup forest, but you cannot do a Full Delete on such forests.</Note>
<Body>
<A ID="pgfId-1038133"></A>
To delete a forest, complete the following procedure:</Body>
<Number1>
<A ID="pgfId-1038134"></A>
Click the Forests icon on the left tree menu.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1038135"></A>
Decide which forest to delete.</Number>
<Number>
<A ID="pgfId-1038136"></A>
Click the forest name, either on the tree menu or the summary page.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1038138"></A>
The Forest Configuration page displays.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1038143"></A>
Click the Delete button on the Forest Configuration page.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1038144"></A>
A confirmation message displays.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1038145"></A>
Select either Configuration Only to delete only the configuration information, or Full Delete to delete the configuration information and the document data.</Number>
<Number>
<A ID="pgfId-1048953"></A>
Click OK.</Number>
</NumberList>
<EndList-root>
<A ID="pgfId-1038146"></A>
Deleting a forest is a 'hot' task; the changes take effect immediately.</EndList-root>
</XML>
