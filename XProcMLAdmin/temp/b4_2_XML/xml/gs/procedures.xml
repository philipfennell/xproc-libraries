<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="procedures.css" type="text/css" charset="UTF-8"?>
<XML>
<TITLE> </TITLE><Heading-1>
<A ID="pgfId-1040655"></A>
Getting Started with MarkLogic Server Applications</Heading-1>
<pagenum>
<A ID="pgfId-1050076"></A>
21</pagenum>
<Body>
<A ID="pgfId-1040656"></A>
This section describes the following procedures to get started using MarkLogic Server on your system:</Body>
<Body-bullet>
<A ID="pgfId-1040660"></A>
<A href="procedures.xml#id(98406)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Exploring the Use Cases</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1040664"></A>
<A href="procedures.xml#id(22010)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Creating a New Server</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1040668"></A>
<A href="procedures.xml#id(15787)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Sample XQuery Application</Hyperlink>
</A></Body-bullet>
<Body>
<A ID="pgfId-1040669"></A>
Be sure to complete each procedure in the order presented.</Body>
<Heading-2>
<A ID="pgfId-1040670"></A>
<A ID="98406"></A>
Exploring the Use Cases</Heading-2>
<Body>
<A ID="pgfId-1040671"></A>
As part of the XQuery standard, the W3C working group has assembled a set of use cases that demonstrate how XQuery can be used to accomplish a variety of sample tasks. As part of its installation process, MarkLogic Server sets up a server environment that incorporates working demonstrations of these use cases. The use cases provide an excellent starting point for familiarizing yourself with the XQuery language and with some important aspects of MarkLogic Server.</Body>
<Body>
<A ID="pgfId-1040672"></A>
To explore the use cases, complete the following steps:</Body>
<Number1>
<A ID="pgfId-1040673"></A>
Go to the following URL:</Number1>
<Body-indent>
<A ID="pgfId-1040675"></A>
<Hyperlink>
<A href="http://localhost:8000/" xml:link="simple" show="replace" actuate="user" CLASS="URL">http://localhost:8000/</A></Hyperlink>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040676"></A>
Click the 'Load source XML into database' link at the top left frame.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1040677"></A>
The confirmation message displays in the top right frame.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040678"></A>
View the following list of use cases on the left:</Number>
</NumberList>
<Body-bullet-2>
<A ID="pgfId-1040679"></A>
Exemplars</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040680"></A>
Tree</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040681"></A>
Sequence</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040682"></A>
Relational</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040683"></A>
SGML</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040684"></A>
String Search</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040685"></A>
Namespace</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040686"></A>
Recursive</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040687"></A>
Strong</Body-bullet-2>
<EndList-root>
<A ID="pgfId-1040688"></A>
At this point, you have different options to explore the use cases. We recommend you use the following procedures as examples to maximize your experience with the use cases:</EndList-root>
<Body-bullet>
<A ID="pgfId-1040692"></A>
<A href="procedures.xml#id(74536)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Viewing the Source XML</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1040696"></A>
<A href="procedures.xml#id(34339)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Viewing a Use Case</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1040701"></A>
<A href="procedures.xml#id(33912)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Editing a Use Case</Hyperlink>
</A></Body-bullet>
<Body>
<A ID="pgfId-1040702"></A>
You may complete these procedures in any order.</Body>
<Heading-3>
<A ID="pgfId-1040703"></A>
<A ID="74536"></A>
Viewing the Source XML</Heading-3>
<Note>
<A ID="pgfId-1040704"></A>
This procedure focuses on the first use case topic, 'Exemplars.' You may view the source XML for any of the use cases.</Note>
<Body>
<A ID="pgfId-1040705"></A>
To view the source XML, complete the following steps:</Body>
<Number1>
<A ID="pgfId-1040707"></A>
Click on the '1.0 Source XML' link in the left frame.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1040708"></A>
View the source code in the XQuery Source Window.</Number>
<Number>
<A ID="pgfId-1040709"></A>
Scroll to the bottom of your XQuery Source Window and click Submit Query.</Number>
<Number>
<A ID="pgfId-1040710"></A>
View the source XML at the bottom in the XQuery Results window.</Number>
</NumberList>
<Heading-3>
<A ID="pgfId-1040711"></A>
<A ID="34339"></A>
Viewing a Use Case</Heading-3>
<Note>
<A ID="pgfId-1040713"></A>
This procedure focuses on the first use case in 'Exemplars.' You may view any use case in other topics as well.</Note>
<Body>
<A ID="pgfId-1040714"></A>
To view the use case, complete the following steps:</Body>
<Number1>
<A ID="pgfId-1040715"></A>
Click on the '1.1 Value constraints' link in the left frame.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1040716"></A>
View the comment in the XQuery Source window:</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1040717"></A>
'Lists books published by Addison-Wesley after 1991 including their year and title.'</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040718"></A>
Scroll to the bottom of your XQuery Source Window.</Number>
<Number>
<A ID="pgfId-1040719"></A>
Note that your current mode is one of the following:</Number>
</NumberList>
<Body-bullet-2>
<A ID="pgfId-1040720"></A>
Query generates XML (Switch to HTML)</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040721"></A>
Query generates HTML (Switch to XML)</Body-bullet-2>
<Body-indent>
<A ID="pgfId-1040722"></A>
If your query generates XML, then it displays the information with XML tags. If your query generates HTML, then it displays the information in an easy-to-read table format.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040724"></A>
Determine whether to view your query results in XML or HTML mode.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1040725"></A>
To view query results in XML, be sure to use a browser capable of displaying XML. Internet Explorer or Firefox, for example, can display XML directly while some browsers, like older versions of Netscape Navigator, cannot.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040727"></A>
Keep your mode as-is, or switch modes by clicking the appropriate link.</Number>
<Number>
<A ID="pgfId-1040728"></A>
Click Submit Query.</Number>
<Number>
<A ID="pgfId-1040729"></A>
View your results.</Number>
</NumberList>
<EndList-root>
<A ID="pgfId-1040730"></A>
You may toggle between XML and HTML modes as needed. If you switch modes, however, be sure to resubmit the query to see the new results.</EndList-root>
<Body>
<A ID="pgfId-1040731"></A>
The following example shows the results in HTML:</Body>
<Body>
<A ID="pgfId-1040735"></A>
<IMAGE xml:link="simple" href="images/use_cases.gif" show="embed" actuate="auto"/>
</Body>
<Heading-3>
<A ID="pgfId-1040736"></A>
<A ID="33912"></A>
Editing a Use Case</Heading-3>
<Note>
<A ID="pgfId-1040737"></A>
This procedure focuses on the first use case in 'Exemplars.' You may edit any use case in the list.</Note>
<Body>
<A ID="pgfId-1040738"></A>
To edit a use case, complete the following steps:</Body>
<Number1>
<A ID="pgfId-1040739"></A>
Click on the '1.1 Value constraints' link.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1040740"></A>
View the source code in the XQuery Source window.</Number>
<Number>
<A ID="pgfId-1040741"></A>
Change the following source from:</Number>
</NumberList>
<TableAnchor>
<A ID="pgfId-1041085"></A>
</TableAnchor>
<TABLE>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CodeNoIndent>
<A ID="pgfId-1041235"></A>
where $b/publisher = &quot;Addison-Wesley&quot; and $b/@year &gt; 1991</CodeNoIndent>
</CELL>
</ROW>
</TABLE>
<Body-indent>
<A ID="pgfId-1040743"></A>
to:</Body-indent>
<TableAnchor>
<A ID="pgfId-1041113"></A>
</TableAnchor>
<TABLE>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CodeNoIndent>
<A ID="pgfId-1041243"></A>
where $b/publisher = &quot;Addison-Wesley&quot; and $b/@year &gt; 1993 </CodeNoIndent>
</CELL>
</ROW>
</TABLE>
<NumberList>
<Number>
<A ID="pgfId-1040745"></A>
Check your current mode.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1040746"></A>
If you are in XML mode, you do not need to make other changes. However, if you are in HTML mode, then you also need to change the table header to display the correct year. Change the following source from:</Body-indent>
<TableAnchor>
<A ID="pgfId-1041120"></A>
</TableAnchor>
<TABLE>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CodeNoIndent>
<A ID="pgfId-1041251"></A>
&lt;td class=&quot;title&quot; colspan=&quot;2&quot;&gt; Use case Q1.1: published since 1991 &lt;/td&gt;</CodeNoIndent>
</CELL>
</ROW>
</TABLE>
<Body-indent>
<A ID="pgfId-1040748"></A>
to:</Body-indent>
<TableAnchor>
<A ID="pgfId-1041132"></A>
</TableAnchor>
<TABLE>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CodeNoIndent>
<A ID="pgfId-1041262"></A>
&lt;td class=&quot;title&quot; colspan=&quot;2&quot;&gt; Use case Q1.1: published since 1993 &lt;/td&gt;</CodeNoIndent>
</CELL>
</ROW>
</TABLE>
<Body-indent>
<A ID="pgfId-1040750"></A>
This change ensures that the table header matches the new query results.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040751"></A>
Click Submit Query.</Number>
<Number>
<A ID="pgfId-1040752"></A>
View the new query results.</Number>
</NumberList>
<Body>
<A ID="pgfId-1040756"></A>
<IMAGE xml:link="simple" href="images/use_cases_mod.gif" show="embed" actuate="auto"/>
</Body>
<Note>
<A ID="pgfId-1040757"></A>
You may change the source as much as you like. Explore and customize each use case as thoroughly as possible. MarkLogic Server reverts to the original source when you go to the next use case.</Note>
<Heading-2>
<A ID="pgfId-1040758"></A>
<A ID="22010"></A>
Creating a New Server</Heading-2>
<Body>
<A ID="pgfId-1040759"></A>
To create a new server, complete the following steps:</Body>
<Number1>
<A ID="pgfId-1040760"></A>
Open a new browser.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1040761"></A>
Go to the following URL:</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1040763"></A>
<Hyperlink>
<A href="http://localhost:8001" xml:link="simple" show="replace" actuate="user" CLASS="URL">http://localhost:8001/</A></Hyperlink>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040764"></A>
Log in with your admin username and password.</Number>
<Number>
<A ID="pgfId-1040765"></A>
Click the Groups icon on the left.</Number>
<Number>
<A ID="pgfId-1040766"></A>
Click on the Default icon within the Groups branch.</Number>
<Number>
<A ID="pgfId-1040767"></A>
Click on the App Servers icon within the Default group.</Number>
<Number>
<A ID="pgfId-1040768"></A>
Click the Create HTTP tab.</Number>
<Number>
<A ID="pgfId-1040770"></A>
Go to the HTTP Server Name field and enter TestServer.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1040771"></A>
This will be the name that the Admin Interface uses to reference your server on display screens and in user interface controls.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040772"></A>
Go to the Root directory field and enter Test.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1040773"></A>
By default, the software looks for this directory in your MarkLogic Server program directory, as specified in your installation guide. You may also specify an absolute path (such as <code>
C:\MarkLogicFiles\Test</code>
 on a Windows platform).</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040774"></A>
Go to the Port field and enter 8005.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1046676"></A>
The following screen shows an HTTP server with these values:</Body-indent>
<Graphic>
<A ID="pgfId-1046677"></A>
<IMAGE xml:link="simple" href="images/httpAdd.gif" show="embed" actuate="auto"/>
</Graphic>
<NumberList>
<Number>
<A ID="pgfId-1041644"></A>
Scroll down to Authentication and click 'application-level'.</Number>
<Number>
<A ID="pgfId-1041652"></A>
Choose an admin user (admin) as the Default User.</Number>
<Number>
<A ID="pgfId-1041653"></A>
Leave the privilege field blank.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1041722"></A>
The following screen shows an HTTP server with these values</Body-indent>
<GraphicIndent>
<A ID="pgfId-1041726"></A>
<IMAGE xml:link="simple" href="images/authentication.gif" show="embed" actuate="auto"/>
</GraphicIndent>
<NumberList>
<Number>
<A ID="pgfId-1041727"></A>
Scroll to the top or bottom and click OK.</Number>
<Number>
<A ID="pgfId-1057614"></A>
See that TestServer is added to the HTTP Server branch.</Number>
</NumberList>
<Heading-2>
<A ID="pgfId-1057616"></A>
<A ID="15787"></A>
Sample XQuery Application</Heading-2>
<Body>
<A ID="pgfId-1057617"></A>
To run the sample XQuery application, complete the following steps:</Body>
<Number1>
<A ID="pgfId-1057605"></A>
Use the following table to locate your MarkLogic Server program directory:</Number1>
<TableAnchor>
<A ID="pgfId-1040803"></A>
</TableAnchor>
<TABLE>
<ROW>
<TH ROWSPAN="1" COLSPAN="1">
<CellHeading>
<A ID="pgfId-1050062"></A>
Platform</CellHeading>
</TH>
<TH ROWSPAN="1" COLSPAN="1">
<CellHeading>
<A ID="pgfId-1050064"></A>
Program Directory</CellHeading>
</TH>
</ROW>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1040792"></A>
Microsoft Windows</CellBody>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1040794"></A>
C:\Program Files\MarkLogic</CellBody>
</CELL>
</ROW>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1040796"></A>
Red Hat Linux</CellBody>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1040798"></A>
/opt/MarkLogic</CellBody>
</CELL>
</ROW>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1040800"></A>
Sun Solaris</CellBody>
</CELL>
<CELL ROWSPAN="1" COLSPAN="1">
<CellBody>
<A ID="pgfId-1040802"></A>
/opt/MARKlogic</CellBody>
</CELL>
</ROW>
</TABLE>
<NumberList>
<Number>
<A ID="pgfId-1040805"></A>
Go to this program directory and create a new directory called Test.</Number>
<Number>
<A ID="pgfId-1040806"></A>
This Test directory is the root directory that you just configured for your new HTTP server.</Number>
<Number>
<A ID="pgfId-1040807"></A>
Open a text editor and create a new file called <code>
load.xqy</code>
 in the Test directory. </Number>
<Number>
<A ID="pgfId-1049701"></A>
Copy and save the following code into this <code>
.xqy</code>
 file:</Number>
</NumberList>
<TableAnchor>
<A ID="pgfId-1041149"></A>
</TableAnchor>
<TABLE>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<Code>
<A ID="pgfId-1041441"></A>
xquery version &quot;1.0-ml&quot;;
(: load.xqy :)
xdmp:document-insert(&quot;books.xml&quot;,
&#160;&#160;&lt;books xmlns=&quot;http://www.marklogic.com/ns/gs-books&quot;&gt;
&#160;&#160;&#160;&#160;&lt;book bookid=&quot;1&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&lt;title&gt;A Quick Path to an Application&lt;/title&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&lt;author&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;last&gt;Smith&lt;/last&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;first&gt;Jim&lt;/first&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&lt;/author&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&lt;publisher&gt;Scribblers Press&lt;/publisher&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&lt;isbn&gt;1494-3930392-3&lt;/isbn&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&lt;abstract&gt;This book describes in detail the power of how to use XQuery to build powerful web applications that are built on the MarkLogic Server platform.&lt;/abstract&gt;
&#160;&#160;&#160;&#160;&lt;/book&gt;
&#160;&#160;&lt;/books&gt;
),

&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&#160;&#160;&lt;head&gt;
&#160;&#160;&#160;&#160;&lt;title&gt;Database loaded&lt;/title&gt;
&#160;&#160;&lt;/head&gt;

&#160;&#160;&lt;body&gt;
&lt;b&gt;Source XML Loaded&lt;/b&gt;
&lt;p&gt;The source XML has been successfully loaded into the database&lt;/p&gt;
&#160;&#160;&lt;/body&gt;
&lt;/html&gt;</Code>
</CELL>
</ROW>
</TABLE>
<NumberList>
<Number>
<A ID="pgfId-1040810"></A>
Create another file called <code>
dump.xqy</code>
 in the Test directory.</Number>
<Number>
<A ID="pgfId-1040811"></A>
Copy and save the following code into this <code>
.xqy</code>
 file:</Number>
</NumberList>
<TableAnchor>
<A ID="pgfId-1041159"></A>
</TableAnchor>
<TABLE>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<Code>
<A ID="pgfId-1057491"></A>
xquery version &quot;1.0-ml&quot;;
(: dump.xqy :)
declare namespace bk = &quot;http://www.marklogic.com/ns/gs-books&quot;;

&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&#160;&#160;&lt;head&gt;
&#160;&#160;&#160;&#160;&lt;title&gt;Database dump&lt;/title&gt;
&#160;&#160;&lt;/head&gt;
&#160;&#160;&lt;body&gt;
&#160;&#160;&lt;b&gt;XML Content&lt;/b&gt;
{
&#160;&#160;&#160;&#160;for $book in doc(&quot;books.xml&quot;)/bk:books/bk:book
&#160;&#160;&#160;&#160;return
&#160;&#160;&#160;&#160;&lt;pre&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Title: { $book/bk:title/text() }
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Author: { ($book/bk:author/bk:first/text(), &quot; &quot;,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;$book/bk:author/bk:last/text()) }
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Publisher: { $book/bk:publisher/text() }
&#160;&#160;&#160;&#160;&lt;/pre&gt;
}
&#160;&#160;&#160;&#160;&lt;a href=&quot;update-form.xqy&quot;&gt;Update Publisher&lt;/a&gt;
&#160;&#160;&lt;/body&gt;
&lt;/html&gt;</Code>
</CELL>
</ROW>
</TABLE>
<NumberList>
<Number>
<A ID="pgfId-1040813"></A>
Create another file called <code>
update-form.xqy</code>
 in the Test directory.</Number>
<Number>
<A ID="pgfId-1040814"></A>
Copy and save the following code into this <code>
.xqy</code>
 file:</Number>
</NumberList>
<TableAnchor>
<A ID="pgfId-1041166"></A>
</TableAnchor>
<TABLE>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<Code>
<A ID="pgfId-1041483"></A>
xquery version &quot;1.0-ml&quot;;
(: update-form.xqy :)
declare namespace bk=&quot;http://www.marklogic.com/ns/gs-books&quot;;</Code>
<Code>
<A ID="pgfId-1057584"></A>
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&#160;&#160;&lt;head&gt;
&#160;&#160;&#160;&#160;&lt;title&gt;Change Publisher&lt;/title&gt;
&#160;&#160;&lt;/head&gt;
&#160;&#160;&lt;body&gt;
&#160;&#160;&#160;&#160;{
&#160;&#160;&#160;&#160;&#160;&#160;let $book := doc(&quot;books.xml&quot;)/bk:books/bk:book[1]
&#160;&#160;&#160;&#160;&#160;&#160;return
&#160;&#160;&#160;&#160;&#160;&#160;&lt;form action=&quot;update-write.xqy&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;input type=&quot;hidden&quot; name=&quot;bookid&quot; value=&quot;{ $book/@bookid }&quot;/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;p&gt;&lt;b&gt;
Change publisher for book &lt;i&gt;{ $book/bk:title/text() }&lt;/i&gt;:
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/b&gt;&lt;/p&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;input type=&quot;text&quot; name=&quot;publisher&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;value=&quot;{ $book/bk:publisher/text() }&quot;/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;input type=&quot;submit&quot; value=&quot;Update publisher&quot;/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&lt;/form&gt;
&#160;&#160;}
&#160;&#160;&lt;/body&gt;
&lt;/html&gt;</Code>
</CELL>
</ROW>
</TABLE>
<NumberList>
<Number>
<A ID="pgfId-1040816"></A>
Create another file called <code>
update-write.xqy</code>
 in the Test directory.</Number>
<Number>
<A ID="pgfId-1040817"></A>
Copy and save the following code into this <code>
.xqy</code>
 file:</Number>
</NumberList>
<TableAnchor>
<A ID="pgfId-1041173"></A>
</TableAnchor>
<TABLE>
<ROW>
<CELL ROWSPAN="1" COLSPAN="1">
<Code>
<A ID="pgfId-1041501"></A>
xquery version &quot;1.0-ml&quot;;
(: update-write.xqy :)
declare namespace bk=&quot;http://www.marklogic.com/ns/gs-books&quot;;

declare function local:updatePublisher()
{
&#160;&#160;if (doc(&quot;books.xml&quot;)) then
&#160;&#160;&#160;&#160;let $bookid := xdmp:get-request-field(&quot;bookid&quot;)
&#160;&#160;&#160;&#160;let $publisher := xdmp:get-request-field(&quot;publisher&quot;)
&#160;&#160;&#160;&#160;let $b := doc(&quot;books.xml&quot;)/bk:books/bk:book[@bookid = $bookid]
&#160;&#160;return
&#160;&#160;&#160;&#160;&#160;&#160;if ($b) then
&#160;&#160;&#160;&#160;(
&#160;&#160;&#160;&#160;&#160;&#160;xdmp:node-replace($b/bk:publisher,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;bk:publisher&gt;{ $publisher }&lt;/bk:publisher&gt;)
,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;xdmp:redirect-response(&quot;dump.xqy&quot;)
&#160;&#160;&#160;&#160;)
&#160;&#160;&#160;&#160;&#160;&#160;else
&#160;&#160;&#160;&#160;&lt;span&gt;Could not locate book with bookid { $bookid }.&lt;/span&gt;
&#160;&#160;&#160;&#160;&#160;&#160;else
&#160;&#160;&#160;&#160;&lt;span&gt;Unable to access parent XML document.&lt;/span&gt;
};

&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&#160;&#160;&lt;head&gt;
&#160;&#160;&#160;&#160;&lt;title&gt;Update In Process&lt;/title&gt;
&#160;&#160;&lt;/head&gt;

&#160;&#160;&lt;body&gt;
Attempting to complete update and redirect browser to detail page.
&#160;&#160;&#160;&#160;&lt;p&gt;
If you are seeing this page, either the redirect has failed
or the update has failed.  The update has failed if there is
a reason provided below:
&#160;&#160;&#160;&#160;&#160;&#160;&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;{ local:updatePublisher() }
&#160;&#160;&#160;&#160;&lt;/p&gt;
&#160;&#160;&lt;/body&gt;
&lt;/html&gt;</Code>
</CELL>
</ROW>
</TABLE>
<NumberList>
<Number>
<A ID="pgfId-1040819"></A>
Confirm that you have the following new files in your Test directory:</Number>
</NumberList>
<Body-bullet-2>
<A ID="pgfId-1040820"></A>
<code>
load.xqy</code>
</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040821"></A>
<code>
dump.xqy</code>
</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040822"></A>
<code>
update-form.xqy</code>
</Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040823"></A>
<code>
update-write.xqy</code>
</Body-bullet-2>
<NumberList>
<Number>
<A ID="pgfId-1040824"></A>
Confirm that all files end with the <code>
.xqy</code>
 extension, not the <code>
.txt</code>
 extension.</Number>
<Number>
<A ID="pgfId-1040825"></A>
Using these files, continue to the following procedures:</Number>
</NumberList>
<Body-bullet-2>
<A ID="pgfId-1040829"></A>
<A href="procedures.xml#id(31370)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Loading the Source XML</Hyperlink>
</A></Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040833"></A>
<A href="procedures.xml#id(26869)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Generating a Simple Report</Hyperlink>
</A></Body-bullet-2>
<Body-bullet-2>
<A ID="pgfId-1040837"></A>
<A href="procedures.xml#id(49941)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Submitting New Information</Hyperlink>
</A></Body-bullet-2>
<Body-indent>
<A ID="pgfId-1040838"></A>
Be sure to complete these procedures in order.</Body-indent>
<Heading-3>
<A ID="pgfId-1040839"></A>
<A ID="31370"></A>
Loading the Source XML</Heading-3>
<Body>
<A ID="pgfId-1040840"></A>
To load the source XML, complete the following procedure:</Body>
<Body>
<A ID="pgfId-1040841"></A>
Open a new browser.</Body>
<Body>
<A ID="pgfId-1040842"></A>
Go to the following URL:</Body>
<Body-indent>
<A ID="pgfId-1040843"></A>
<Hyperlink>
<A href="http://localhost:8005/load.xqy" xml:link="simple" show="replace" actuate="user" CLASS="URL">http://localhost:8005/load.xqy</A></Hyperlink>
</Body-indent>
<Body-indent>
<A ID="pgfId-1040844"></A>
MarkLogic Server is running the new <code>
load.xqy</code>
 file.</Body-indent>
<Body>
<A ID="pgfId-1040845"></A>
View the following confirmation message:</Body>
<Body-indent>
<A ID="pgfId-1040849"></A>
<IMAGE xml:link="simple" href="images/loaded.gif" show="embed" actuate="auto"/>
</Body-indent>
<Heading-3>
<A ID="pgfId-1040850"></A>
<A ID="26869"></A>
Generating a Simple Report</Heading-3>
<Body>
<A ID="pgfId-1040851"></A>
To generate a simple report from the newly loaded XML, complete the following steps:</Body>
<Number1>
<A ID="pgfId-1040852"></A>
Go to the following URL:</Number1>
<Body-indent>
<A ID="pgfId-1040853"></A>
<Hyperlink>
<A href="http://localhost:8005/dump.xqy" xml:link="simple" show="replace" actuate="user" CLASS="URL">http://localhost:8005/dump.xqy</A></Hyperlink>
</Body-indent>
<Body-indent>
<A ID="pgfId-1040854"></A>
MarkLogic Server is running the new <code>
dump.xqy</code>
 file.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040855"></A>
View the new HTML-compatible report:</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1040859"></A>
<IMAGE xml:link="simple" href="images/dump.gif" show="embed" actuate="auto"/>
</Body-indent>
<Heading-3>
<A ID="pgfId-1040860"></A>
<A ID="49941"></A>
Submitting New Information</Heading-3>
<Body>
<A ID="pgfId-1040861"></A>
To submit new information to the database, complete the following steps:</Body>
<Number1>
<A ID="pgfId-1040862"></A>
Go to the following URL:</Number1>
<Body-indent>
<A ID="pgfId-1040863"></A>
<Hyperlink>
<A href="http://localhost:8005/update-form.xqy" xml:link="simple" show="replace" actuate="user" CLASS="URL">http://localhost:8005/update-form.xqy</A></Hyperlink>
</Body-indent>
<Body-indent>
<A ID="pgfId-1040864"></A>
MarkLogic Server is running the new <code>
update-form.xqy</code>
 file.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040865"></A>
View the simple form to update a publisher:</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1040869"></A>
<IMAGE xml:link="simple" href="images/update-form.gif" show="embed" actuate="auto"/>
</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040870"></A>
Enter 'Menlo Books' as the new publisher.</Number>
<Number>
<A ID="pgfId-1040871"></A>
Click Update publisher.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1040872"></A>
This action automatically calls <code>
update-write.xqy</code>
 to update the publisher element in the database.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1040873"></A>
View the new XML content.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1040877"></A>
<IMAGE xml:link="simple" href="images/updated.gif" show="embed" actuate="auto"/>
</Body-indent>
<Note>
<A ID="pgfId-1040878"></A>
You can continue exploring your new files or write your own code to create new XQuery applications.</Note>
</XML>
