<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet href="domains.css" type="text/css" charset="UTF-8"?>
<XML>
<TITLE> </TITLE><Heading-1>
<A ID="pgfId-1044208"></A>
<A ID="11600"></A>
Understanding and Using Domains</Heading-1>
<pagenum>
<A ID="pgfId-1045136"></A>
18</pagenum>
<Body>
<A ID="pgfId-1044209"></A>
This chapter describes domains in the MarkLogic Server Content Processing Framework, and includes the following sections:</Body>
<Body-bullet>
<A ID="pgfId-1045252"></A>
<A href="domains.xml#id(46913)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Overview of Domains</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1049329"></A>
<A href="domains.xml#id(17245)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Domain Scope and Code Evaluation Context</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1049739"></A>
<A href="domains.xml#id(89993)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Rules for Domains</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1049417"></A>
<A href="domains.xml#id(10566)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Creating and Modifying Domains</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1045256"></A>
<A href="domains.xml#id(40535)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Attaching and Detaching Pipelines to Domains</Hyperlink>
</A></Body-bullet>
<Heading-2>
<A ID="pgfId-1045274"></A>
<A ID="46913"></A>
Overview of Domains</Heading-2>
<Body>
<A ID="pgfId-1049066"></A>
Applications often perform the same content processing operations on a set of documents. For example, you might have a set of XML documents that come from one source, and you need to perform the same processing on each of those documents. The MarkLogic Server Content Processing Framework uses <Emphasis>
domains</Emphasis>
 to describe a group of documents to which the same content processing operations should be applied. </Body>
<Body>
<A ID="pgfId-1049332"></A>
You can use domains to partition sets of documents in meaningful ways, and apply the same content processing to all documents in a given set of documents. For example, if you have one set of documents that comes from Company&#160;X in a certain form, and another set of documents that comes from Company&#160;Y in a different form, you can define a different set of content processing for each set of documents. You can then create domains for each set of documents, running the appropriate sequence content processing operations on each type of document.</Body>
<Heading-2>
<A ID="pgfId-1049132"></A>
<A ID="17245"></A>
Domain Scope and Code Evaluation Context</Heading-2>
<Body>
<A ID="pgfId-1049138"></A>
You can view a content processing application as having two parts:</Body>
<Body-bullet>
<A ID="pgfId-1049348"></A>
Documents (content) processed by the application.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1049353"></A>
Code that makes up the application.</Body-bullet>
<Body>
<A ID="pgfId-1049349"></A>
Each domain includes configuration information for documents (answering the question: <Emphasis>
which documents will be processed by this application?</Emphasis>
) as well as configuration information for code (answering the question: <Emphasis>
where is the code that makes up this application?</Emphasis>
). This section describes both of these configurations associated with a domain and includes the following sections:</Body>
<Body-bullet>
<A ID="pgfId-1049374"></A>
<A href="domains.xml#id(52912)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Domain Scope</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1049379"></A>
<A href="domains.xml#id(76193)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Evaluation Context</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1049402"></A>
<A href="domains.xml#id(84778)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Domain Scope Can Encapsulate Processing Logic</Hyperlink>
</A></Body-bullet>
<Heading-3>
<A ID="pgfId-1049259"></A>
<A ID="52912"></A>
Domain Scope</Heading-3>
<Body>
<A ID="pgfId-1049155"></A>
The <Emphasis>
domain scope</Emphasis>
 specifies the documents to which this domain applies. The domain scope is defined in the Domain Configuration page of the Admin Interface. </Body>
<Body>
<A ID="pgfId-1049425"></A>
<IMAGE xml:link="simple" href="images/domain_scope.gif" show="embed" actuate="auto"/>
</Body>
<Body>
<A ID="pgfId-1049438"></A>
In the Admin Interface, the <code>
document scope</code>
 drop-down list specifies whether the domain applies to a single document, a directory, or a collection. Each domain can only have one of these document scopes; if you need more than one of these document scopes, you can create multiple domains. </Body>
<Body>
<A ID="pgfId-1049455"></A>
The <code>
uri</code>
 field specifies the URI for the document, directory, or collection specified in the <code>
document scope</code>
.</Body>
<Body>
<A ID="pgfId-1049470"></A>
The <code>
depth</code>
 drop-down list applies only if you specify a <code>
document scope</code>
 of <code>
directory</code>
, and you specify either <code>
0</code>
 to indicate only documents in the immediate directory, or <code>
infinity</code>
 to indicate documents in any directory that is a descendant of the specified directory URI.</Body>
<Heading-3>
<A ID="pgfId-1049156"></A>
<A ID="76193"></A>
Evaluation Context</Heading-3>
<Body>
<A ID="pgfId-1049160"></A>
When you create a domain, the Content Processing Framework automatically creates a set of triggers to listen for events (create, update, delete, property changes, and database online). The queries that the triggers execute run in the specified <Emphasis>
evaluation context</Emphasis>
. This is important because any content processing code that uses this domain also ends up evaluating its modules in this context. </Body>
<Body>
<A ID="pgfId-1049488"></A>
<IMAGE xml:link="simple" href="images/execution_context.gif" show="embed" actuate="auto"/>
</Body>
<Body>
<A ID="pgfId-1049512"></A>
Because the content processing code executes in the specified context, any module imports in the content processing code (for your condition and action modules, for example) are resolved relative to the specified database and URI root. </Body>
<Heading-3>
<A ID="pgfId-1049388"></A>
<A ID="84778"></A>
Domain Scope Can Encapsulate Processing Logic</Heading-3>
<Body>
<A ID="pgfId-1049389"></A>
Because content processing only occurs on documents within the scope of a domain, any content processing code can work under the assumption that all documents it sees require processing. This fact simplifies the processing code, as it does not need to include complex logic to determine if a document needs processing. The fact that a document is in the scope of a particular domain provides all the logic needed to determine that it needs processing.</Body>
<Heading-2>
<A ID="pgfId-1049315"></A>
<A ID="89993"></A>
Rules for Domains</Heading-2>
<Body>
<A ID="pgfId-1049741"></A>
This section describes the following rules for domains:</Body>
<Body-bullet>
<A ID="pgfId-1049793"></A>
<A href="domains.xml#id(24824)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Do Not Overlap Domains</Hyperlink>
</A></Body-bullet>
<Body-bullet>
<A ID="pgfId-1049808"></A>
<A href="domains.xml#id(93906)" xml:link="simple" show="replace" actuate="user" CLASS="XRef"><Hyperlink>
Collection Domain Scope Notes</Hyperlink>
</A></Body-bullet>
<Heading-3>
<A ID="pgfId-1049742"></A>
<A ID="24824"></A>
Do Not Overlap Domains</Heading-3>
<Body>
<A ID="pgfId-1049746"></A>
If you use multiple domains, ensure that no two domains overlap; that is, a domain should not include any documents that are included in another domain. If you have overlapping domains, then it is possible for documents to be processed twice, which can cause unexpected results. For example, if you have a domain defined with infinite directory scope on the directory <code>
/myDomain</code>
, and if you have another domain with infinite directory scope on the directory <code>
/myDomain/docs</code>
, then any documents under the directory <code>
/myDomain/docs</code>
 apply to both domains, so they would get processed twice. If you create an overlapping domain, the Admin Interface issues a warning. While it is possible to create them, MarkLogic recommends that you do not use overlapping domains.</Body>
<Note>
<A ID="pgfId-1049979"></A>
If you are using collection scope in your domains, it might not always be obvious if your domains overlap. Documents can belong to multiple collections, and you can add or remove documents from a collection. Also, a new document can be created in a collection based on the default collections of the user who created the document. Be careful of unexpected overlapping domains when using collection scope domains.</Note>
<Heading-3>
<A ID="pgfId-1049747"></A>
<A ID="93906"></A>
Collection Domain Scope Notes</Heading-3>
<Body>
<A ID="pgfId-1049766"></A>
If you are using a collection-scope domain to specify which documents to convert, any new documents created by the conversion process must also be created as part of the collection specified in the domain. If they are not part of the collection, they will not be recognized by the domain for further processing. </Body>
<Body>
<A ID="pgfId-1049994"></A>
The following are some of the ways you can ensure that documents are part of one or more collections:</Body>
<Body-bullet>
<A ID="pgfId-1050020"></A>
Set the <code>
inherit collections</code>
 option at the database level to <code>
true</code>
 and make sure the parent directory belongs to the collection.</Body-bullet>
<Body-bullet>
<A ID="pgfId-1049767"></A>
The user who initiates content processing (that is, the user who originally creates the documents to be processed, whether by drag and dropping into a WebDAV folder or by some other means) can have the collection specified as a default collection (or have the default collection attached to a role to which the user is assigned). </Body-bullet>
<Body-bullet>
<A ID="pgfId-1049872"></A>
You can explicitly set the collection on a document (for example, in your XQuery module code or through XDBC).</Body-bullet>
<Body>
<A ID="pgfId-1050005"></A>
Collection domain scope is appropriate for some types of applications, particularly when you cannot always control the URI of the document.</Body>
<Note>
<A ID="pgfId-1049875"></A>
Because domains with a collection scope can only continue the next phase of processing if the new or modified document is part of that collection, you can use collections as a way of moving documents in and out of different sets of processing.</Note>
<Heading-2>
<A ID="pgfId-1049740"></A>
<A ID="10566"></A>
Creating and Modifying Domains</Heading-2>
<Body>
<A ID="pgfId-1049412"></A>
You use the Admin Interface to create and modify domains. Perform the following steps to create a domain:</Body>
<Number1>
<A ID="pgfId-1049534"></A>
In the Admin Interface menu, click the Databases link and then click the name of the database to which you want to add a domain.</Number1>
<NumberList>
<Number>
<A ID="pgfId-1049538"></A>
Under the database name, click Content Processing.</Number>
<Number>
<A ID="pgfId-1049539"></A>
If content processing is already installed for your database, you will see links in the navigation tree for Domains and Pipelines. Click Domains.</Number>
</NumberList>
<Body-indent>
<A ID="pgfId-1049540"></A>
If content processing is not installed, install it as described in <A href="custom.xml#id(94030)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Install Content Processing Framework in Database' on page&#160;35</A>.</Body-indent>
<NumberList>
<Number>
<A ID="pgfId-1049541"></A>
Click the Create tab. The Domain Create page appears.</Number>
<Number>
<A ID="pgfId-1049551"></A>
Enter a <code>
domain name</code>
 and a <code>
domain description</code>
.</Number>
<Number>
<A ID="pgfId-1049558"></A>
Specify the <code>
domain scope</code>
. For details on the domain scope, see <A href="domains.xml#id(52912)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Domain Scope' on page&#160;15</A>.</Number>
<Number>
<A ID="pgfId-1049566"></A>
Specify the <code>
evaluation context</code>
. For details on the evaluation context, see <A href="domains.xml#id(76193)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Evaluation Context' on page&#160;15</A>.</Number>
<Number>
<A ID="pgfId-1049578"></A>
Click OK.</Number>
</NumberList>
<Body>
<A ID="pgfId-1049579"></A>
The domain is created. To use the domain, you must attach a pipeline.</Body>
<Body>
<A ID="pgfId-1049729"></A>
Similarly, you can use the Admin Interface to select an existing domain and modify its configuration information.</Body>
<Heading-2>
<A ID="pgfId-1049411"></A>
<A ID="40535"></A>
Attaching and Detaching Pipelines to Domains</Heading-2>
<Body>
<A ID="pgfId-1049716"></A>
To execute a pipeline, it must first be attached to a domain. For details about pipelines, see <A href="pipelines.xml#id(80553)" xml:link="simple" show="replace" actuate="user" CLASS="XRef">'Understanding and Using Pipelines' on page&#160;19</A>.</Body>
<Body>
<A ID="pgfId-1049316"></A>
Perform the following steps to attach or detach pipelines to a domain:</Body>
<Number1>
<A ID="pgfId-1049590"></A>
In the Admin Interface, select the domain to which you want to add a pipeline (for example, Databases &gt; myDatabase &gt; myDomain).</Number1>
<NumberList>
<Number>
<A ID="pgfId-1049597"></A>
Under the domain, select Pipelines. The Domain Pipeline screen appears</Number>
<Number>
<A ID="pgfId-1049603"></A>
Check all the pipelines you want to attach to the domain and uncheck all the pipelines you want to detach from the domain. For most domains, you should select the <code>
Status Change Handling</code>
 pipeline to attach, as well as any other pipelines you are using (including any custom pipelines you have created).</Number>
<Number>
<A ID="pgfId-1049604"></A>
If you want to attach multiple pipelines to the domain, click the checkbox for others.</Number>
<Number>
<A ID="pgfId-1049605"></A>
Click OK.</Number>
</NumberList>
<Body>
<A ID="pgfId-1049077"></A>
The attached pipelines appear at the top of the Domain Pipeline Configuration list. Note that a pipeline can be attached to multiple domains simultaneously.</Body>
</XML>
